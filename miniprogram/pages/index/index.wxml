<!--index.wxml-->
<view class="container">
  <!-- 用户头像区域 -->
  <view class="user-avatar-section">
    <button class="avatar-wrapper" open-type="chooseAvatar" bindchooseavatar="onChooseAvatar">
      <image class="avatar" src="{{avatarUrl}}" mode="aspectFill"></image>
    </button>
    <text class="avatar-tip">点击选择头像</text>
  </view>

  <!-- 昵称输入区域 -->
  <view class="nickname-section">
    <view class="nickname-label">
      <text>昵称</text>
    </view>
    <input type="nickname" class="nickname-input" placeholder="请输入昵称" value="{{nickName}}" bindinput="onNicknameInput" />
  </view>

  <!-- 付费套餐区域 -->
  <view class="payment-section">
    <view class="section-title">
      <text>💎 升级到高级版</text>
      <text class="section-subtitle">解锁更多功能，享受专业服务</text>
    </view>
    
    <view class="payment-options">
      <view class="payment-card basic-card" bindtap="selectPackage" data-type="basic" data-amount="9.9">
        <view class="card-header">
          <text class="package-name">基础包</text>
          <text class="package-price">¥9.9</text>
        </view>
        <view class="package-features">
          <text class="feature-item">✅ 10次增强机会</text>
          <text class="feature-item">✅ 高清图片输出</text>
          <text class="feature-item">✅ 快速处理</text>
        </view>
        <view class="package-desc">适合偶尔使用</view>
      </view>
      
      <view class="payment-card premium-card" bindtap="selectPackage" data-type="premium" data-amount="29.9">
        <view class="popular-badge">
          <text class="badge-text">🔥 热门</text>
        </view>
        <view class="card-header">
          <text class="package-name">高级包</text>
          <text class="package-price">¥29.9</text>
        </view>
        <view class="package-features">
          <text class="feature-item">✅ 100次增强机会</text>
          <text class="feature-item">✅ 超高清输出</text>
          <text class="feature-item">✅ 批量处理</text>
          <text class="feature-item">✅ 优先处理</text>
        </view>
        <view class="package-desc">性价比最高</view>
        <view class="savings-tag">省70%</view>
      </view>
      
      <view class="payment-card unlimited-card" bindtap="selectPackage" data-type="unlimited" data-amount="99.9">
        <view class="card-header">
          <text class="package-name">无限包</text>
          <text class="package-price">¥99.9</text>
        </view>
        <view class="package-features">
          <text class="feature-item">✅ 无限次使用</text>
          <text class="feature-item">✅ 最高质量输出</text>
          <text class="feature-item">✅ 批量处理</text>
          <text class="feature-item">✅ 专属客服</text>
        </view>
        <view class="package-desc">专业用户首选</view>
        <view class="vip-tag">VIP</view>
      </view>
    </view>

    <!-- 用户当前状态 -->
    <view class="user-status">
      <view class="status-item">
        <text class="status-label">剩余次数：</text>
        <text class="status-value">{{remainingCount}}</text>
      </view>
      <view class="status-item">
        <text class="status-label">会员等级：</text>
        <text class="status-value {{userLevel}}">{{userLevelText}}</text>
      </view>
    </view>

    <!-- 调试按钮区域 -->
    <view class="debug-section">
      <button class="debug-btn" bindtap="getUserOpenId">
        <text class="debug-icon">🔍</text>
        <text class="debug-text">获取OpenID</text>
      </button>
    </view>
  </view>

  <!-- 标题区域 -->
  <view class="header">
    <text class="title">AI图片增强 - 喵喵美颜</text>
    <text class="subtitle">免费AI智能图片处理，无需下载，微信内即可使用</text>
    <view class="highlight-badge">
      <text class="badge-text">🔥 热门工具</text>
      <text class="badge-text">✨ 免费使用</text>
      <text class="badge-text">⚡ 无需下载</text>
    </view>
  </view>

  <!-- 功能介绍区域 -->
  <view class="features-section">
    <view class="section-title">
      <text>🚀 为什么选择我们？</text>
    </view>
    
    <view class="features-grid">
      <view class="feature-card highlight-card">
        <text class="feature-icon">🤖</text>
        <text class="feature-title">AI智能增强</text>
        <text class="feature-desc">比醒图、美图秀秀更先进的AI算法</text>
        <text class="feature-tag">技术领先</text>
      </view>
      
      <view class="feature-card highlight-card">
        <text class="feature-icon">💰</text>
        <text class="feature-title">完全免费</text>
        <text class="feature-desc">无需付费，无广告干扰，纯净体验</text>
        <text class="feature-tag">免费使用</text>
      </view>
      
      <view class="feature-card highlight-card">
        <text class="feature-icon">📱</text>
        <text class="feature-title">无需下载</text>
        <text class="feature-desc">微信内直接使用，告别APP下载烦恼</text>
        <text class="feature-tag">便捷高效</text>
      </view>
      
      <view class="feature-card highlight-card">
        <text class="feature-icon">💾</text>
        <text class="feature-title">一键保存</text>
        <text class="feature-desc">直接保存到手机相册</text>
        <text class="feature-tag">操作简单</text>
      </view>
    </view>
  </view>

  <!-- 竞品对比区域 -->
  <view class="comparison-section">
    <view class="section-title">
      <text>🏆 与其他工具对比</text>
    </view>
    
    <view class="comparison-table">
      <view class="comparison-header">
        <text class="feature-column">功能对比</text>
        <text class="our-tool">喵喵美颜</text>
        <text class="competitor">醒图</text>
        <text class="competitor">美图秀秀</text>
      </view>
      
      <view class="comparison-row">
        <text class="feature-name">免费使用</text>
        <text class="our-value">✅ 完全免费</text>
        <text class="comp-value">❌ 部分付费</text>
        <text class="comp-value">❌ 部分付费</text>
      </view>
      
      <view class="comparison-row">
        <text class="feature-name">无需下载</text>
        <text class="our-value">✅ 微信内使用</text>
        <text class="comp-value">❌ 需要下载APP</text>
        <text class="comp-value">❌ 需要下载APP</text>
      </view>
      
      <view class="comparison-row">
        <text class="feature-name">AI技术</text>
        <text class="our-value">✅ 最新AI算法</text>
        <text class="comp-value">✅ AI技术</text>
        <text class="comp-value">⚠️ 传统算法</text>
      </view>
      
      <view class="comparison-row">
        <text class="feature-name">微信分享</text>
        <text class="our-value">✅ 一键分享</text>
        <text class="comp-value">⚠️ 需要保存后分享</text>
        <text class="comp-value">⚠️ 需要保存后分享</text>
      </view>
    </view>
  </view>

  <!-- 图片处理功能区域 -->
  <view class="processing-section">
    <view class="section-title">
      <text>开始处理</text>
    </view>
    
    <!-- 图片上传区域 -->
    <view class="upload-section">
      <view wx:if="{{!selectedImage}}" class="upload-area" bindtap="chooseImage">
        <view class="upload-icon">📷</view>
        <text class="upload-text">点击选择图片</text>
        <text class="upload-hint">支持 JPG、PNG、AVIF 格式</text>
      </view>
      
      <view wx:else class="image-preview">
        <image class="preview-image" src="{{selectedImage}}" mode="aspectFit"></image>
        <view class="image-info">
          <text class="file-name">{{fileName}}</text>
          <text class="file-size">{{fileSize}}</text>
        </view>
        <button class="change-btn" bindtap="chooseImage">重新选择</button>
      </view>
    </view>

    <!-- 处理按钮 -->
    <view class="action-section" wx:if="{{selectedImage}}">
      <button 
        class="enhance-btn {{isProcessing ? 'processing' : ''}}" 
        bindtap="enhanceImage"
        disabled="{{isProcessing}}"
      >
        <text wx:if="{{!isProcessing}}">开始增强</text>
        <text wx:else>处理中...</text>
      </button>
    </view>

    <!-- 结果展示区域 -->
    <view class="result-section" wx:if="{{enhancedImage}}">
      <view class="result-title">
        <text>处理结果</text>
        <text class="preview-hint">点击图片可放大查看，支持左右滑动切换</text>
        <text class="preview-tip">💡 建议先放大到相同倍数再滑动对比</text>
      </view>
      
      <view class="comparison-container">
        <!-- 原图 -->
        <view class="image-container">
          <text class="image-label">原图</text>
          <view class="image-wrapper" bindtap="previewOriginalImage">
            <image class="result-image" src="{{selectedImage}}" mode="aspectFit"></image>
            <view class="preview-overlay">
              <text class="preview-icon">🔍</text>
            </view>
          </view>
          <text class="image-size">{{originalImageSize}}</text>
          <text class="file-size-info">{{originalFileSize}}</text>
        </view>
        
        <!-- 处理后图片 -->
        <view class="image-container">
          <text class="image-label">增强后</text>
          <view class="image-wrapper" bindtap="previewEnhancedImage">
            <image class="result-image" src="{{enhancedImage}}" mode="aspectFit"></image>
            <view class="preview-overlay">
              <text class="preview-icon">🔍</text>
            </view>
          </view>
          <text class="image-size">{{enhancedImageSize}}</text>
          <text class="file-size-info">{{enhancedFileSize}}</text>
        </view>
      </view>

      <!-- 操作按钮区域 -->
      <view class="action-buttons">
        <button class="download-btn" bindtap="downloadImage">
          <text class="btn-icon">💾</text>
          <text class="btn-text">保存图片</text>
        </button>
        <button class="share-btn" bindtap="shareImage">
          <text class="btn-icon">📤</text>
          <text class="btn-text">分享图片</text>
        </button>
      </view>
     </view>
   </view>
  
   <!-- 处理进度提示 -->
  <view wx:if="{{isProcessing}}" class="processing-overlay">
    <view class="processing-content">
      <view class="loading-spinner"></view>
      <text class="processing-text">AI正在增强您的图片...</text>
      <text class="progress-text">{{progress}}%</text>
      
      <!-- 进度条 -->
      <view class="progress-bar-container">
        <view class="progress-bar">
          <view class="progress-fill" style="width: {{progress}}%"></view>
        </view>
      </view>
      
      <text class="processing-hint">请耐心等待，通常需要10-30秒</text>
    </view>
  </view>

  <!-- 法律条款区域 -->
  <view class="legal-section">
    <view class="legal-links">
      <text class="legal-link" bindtap="openTerms">服务条款</text>
      <text class="legal-separator">|</text>
      <text class="legal-link" bindtap="openPrivacy">隐私政策</text>
    </view>
    <text class="legal-notice">使用本服务即表示您同意相关条款</text>
  </view>
</view>