# åŠŸèƒ½å¿«é€Ÿç´¢å¼•

> **å¿«é€ŸæŸ¥æ‰¾**ï¼šæœ¬æ–‡æ¡£æä¾›æ‰€æœ‰åŠŸèƒ½çš„å¿«é€Ÿç´¢å¼•ï¼Œè¯¦ç»†å†…å®¹è¯·å‚è€ƒ `åŠŸèƒ½å®ç°è®°å½•ä¸æ¢å¤æŒ‡å—.md`

---

## ğŸ“‹ å‰ç«¯é¡µé¢ç´¢å¼•

| é¡µé¢åç§° | ä½ç½® | Gitæäº¤ | æ¢å¤å‘½ä»¤ | è¯´æ˜ |
|---------|------|---------|---------|------|
| é¦–é¡µ | `.trash/pages/home/` | `e2bc7ed` | `cp -r .trash/pages/home/ miniprogram/pages/` | åŠŸèƒ½å¯¼èˆªé¦–é¡µ |
| ç¾é¢œç›¸æœº | `.trash/pages/camera/` | `d0f9975` | `cp -r .trash/pages/camera/ miniprogram/pages/` | AIæ¢è„¸ã€æ»¤é•œ |
| æ‹¼å›¾åä½œ | `.trash/pages/puzzle/` | `bc7af54` | `cp -r .trash/pages/puzzle/ miniprogram/pages/` | å¤šäººæ‹¼å›¾æ¸¸æˆ |
| æ¨èå¥–åŠ± | `.trash/pages/referral/` | `130bb7c` | `cp -r .trash/pages/referral/ miniprogram/pages/` | é‚€è¯·ç ã€å¥–åŠ± |
| é‚€è¯·å¥½å‹ | `.trash/pages/invite/` | `a7226a5` | `cp -r .trash/pages/invite/ miniprogram/pages/` | å¥½å‹åˆ—è¡¨ |
| ç§¯åˆ†å•†åŸ | `.trash/pages/mall/` | `5d02a95` | `cp -r .trash/pages/mall/ miniprogram/pages/` | ç§¯åˆ†å…‘æ¢ |
| ä¸ªäººèµ„æ–™ | `.trash/pages/profile/` | `ad39b35` | `cp -r .trash/pages/profile/ miniprogram/pages/` | ç”¨æˆ·ä¸­å¿ƒ |
| ç”¨æˆ·æµç¨‹ | `.trash/pages/userflow/` | `ad39b35` | `cp -r .trash/pages/userflow/ miniprogram/pages/` | æµç¨‹æ¼”ç¤º |
| æ—¥å¿—é¡µé¢ | `.trash/pages/logs/` | - | `cp -r .trash/pages/logs/ miniprogram/pages/` | ç¤ºä¾‹é¡µé¢ |

---

## ğŸ”§ åç«¯åŠŸèƒ½ç´¢å¼•

| åŠŸèƒ½åç§° | Gitåˆ†æ”¯ | Gitæäº¤ | æ¶‰åŠæ–‡ä»¶ | APIç«¯ç‚¹ |
|---------|---------|---------|---------|---------|
| **å¾®ä¿¡æ”¯ä»˜** | `main` | `7f49a09` | `index.ts/wxml/wxss` | `/api/wechat/pay/create` |
| **OpenIDè·å–** | `main` | `1b85768` | `index.ts` | `/api/wechat/auth/openid` |
| **ç”¨æˆ·å¤´åƒæ˜µç§°** | `main` | `eb0cf7a` | `index.ts/wxml/wxss` | æ— éœ€åç«¯ |
| **ç”¨æˆ·ç­‰çº§ç³»ç»Ÿ** | `feature/frontend-optimization` | - | `index.ts` | æœ¬åœ°å­˜å‚¨ |
| **å‰©ä½™æ¬¡æ•°ç®¡ç†** | `feature/frontend-optimization` | - | `index.ts` | æœ¬åœ°å­˜å‚¨ |

---

## ğŸ¯ å¿«é€Ÿæ¢å¤å‘½ä»¤

### æ¢å¤æ‰€æœ‰é¡µé¢
```bash
# ä¸€é”®æ¢å¤æ‰€æœ‰åˆ é™¤çš„é¡µé¢
for dir in .trash/pages/*/; do
  dirname=$(basename "$dir")
  cp -r "$dir" "miniprogram/pages/$dirname"
done

# ç„¶ååœ¨app.jsonä¸­æ·»åŠ é¡µé¢è·¯å¾„
```

### æ¢å¤å¾®ä¿¡æ”¯ä»˜åŠŸèƒ½
```bash
# 1. æŸ¥çœ‹mainåˆ†æ”¯çš„æ”¯ä»˜ä»£ç 
git show main:miniprogram/pages/index/index.ts | grep -A 80 "createPayment" > /tmp/payment_code.ts

# 2. æ‰‹åŠ¨å¤åˆ¶åˆ°å½“å‰index.ts
# éœ€è¦å¤åˆ¶çš„æ–¹æ³•ï¼š
# - selectPackage()
# - createPayment()
# - callWeChatPay()
# - updateUserPackage()
```

### æ¢å¤ç”¨æˆ·ç³»ç»Ÿ
```bash
# æŸ¥çœ‹mainåˆ†æ”¯çš„ç”¨æˆ·ç³»ç»Ÿä»£ç 
git show main:miniprogram/pages/index/index.ts | grep -A 50 "loadUserInfo" > /tmp/user_system.ts

# éœ€è¦å¤åˆ¶çš„æ–¹æ³•ï¼š
# - loadUserInfo()
# - onChooseAvatar()
# - onNicknameInput()
# - loadUserStatus()
# - checkUserRemainingCount()
```

---

## ğŸ“Š ä»£ç ä½ç½®å¿«é€ŸæŸ¥æ‰¾

### å…³é”®æ–¹æ³•ä½ç½®

| æ–¹æ³•å | åŠŸèƒ½ | æ‰€åœ¨åˆ†æ”¯ | æ–‡ä»¶ |
|-------|------|---------|------|
| `getUserOpenId()` | è·å–OpenID | `main` | `pages/index/index.ts` |
| `selectPackage()` | é€‰æ‹©å¥—é¤ | `main` | `pages/index/index.ts` |
| `createPayment()` | åˆ›å»ºæ”¯ä»˜ | `main` | `pages/index/index.ts` |
| `callWeChatPay()` | è°ƒç”¨æ”¯ä»˜ | `main` | `pages/index/index.ts` |
| `onChooseAvatar()` | é€‰æ‹©å¤´åƒ | `main` | `pages/index/index.ts` |
| `onNicknameInput()` | è¾“å…¥æ˜µç§° | `main` | `pages/index/index.ts` |
| `checkUserRemainingCount()` | æ£€æŸ¥æ¬¡æ•° | `feature/frontend-optimization` | `pages/index/index.ts` |
| `updateUserPackage()` | æ›´æ–°å¥—é¤ | `main` | `pages/index/index.ts` |

### UIç»„ä»¶ä½ç½®

| ç»„ä»¶å | åŠŸèƒ½ | æ‰€åœ¨åˆ†æ”¯ | æ–‡ä»¶ |
|-------|------|---------|------|
| ç”¨æˆ·å¤´åƒåŒºåŸŸ | å¤´åƒé€‰æ‹© | `main` | `pages/index/index.wxml` (è¡Œ3-9) |
| æ˜µç§°è¾“å…¥åŒºåŸŸ | æ˜µç§°è¾“å…¥ | `main` | `pages/index/index.wxml` (è¡Œ11-17) |
| ä»˜è´¹å¥—é¤åŒºåŸŸ | å¥—é¤é€‰æ‹© | `main` | `pages/index/index.wxml` (è¡Œ19-97) |
| ç”¨æˆ·çŠ¶æ€æ˜¾ç¤º | æ¬¡æ•°/ç­‰çº§ | `feature/frontend-optimization` | `pages/index/index.wxml` (è¡Œ74-84) |

---

## ğŸ” Gitå‘½ä»¤å¿«æŸ¥

### æŸ¥çœ‹ç‰¹å®šæ–‡ä»¶çš„å†å²ç‰ˆæœ¬
```bash
# æŸ¥çœ‹mainåˆ†æ”¯çš„index.ts
git show main:miniprogram/pages/index/index.ts

# æŸ¥çœ‹feature/frontend-optimizationåˆ†æ”¯çš„index.wxml
git show feature/frontend-optimization:miniprogram/pages/index/index.wxml

# æŸ¥çœ‹ç‰¹å®šæäº¤çš„æ–‡ä»¶
git show 7f49a09:miniprogram/pages/index/index.ts
```

### å¯¹æ¯”ä¸åŒç‰ˆæœ¬
```bash
# å¯¹æ¯”å½“å‰æ–‡ä»¶ä¸mainåˆ†æ”¯
git diff main -- miniprogram/pages/index/index.ts

# å¯¹æ¯”ä¸¤ä¸ªåˆ†æ”¯
git diff main..feature/frontend-optimization -- miniprogram/pages/index/

# æŸ¥çœ‹æ–‡ä»¶çš„ä¿®æ”¹å†å²
git log --follow -- miniprogram/pages/index/index.ts
```

### æ¢å¤ç‰¹å®šæ–‡ä»¶
```bash
# æ¢å¤mainåˆ†æ”¯çš„index.tsåˆ°ä¸´æ—¶æ–‡ä»¶
git show main:miniprogram/pages/index/index.ts > /tmp/index_main.ts

# æ¢å¤å¹¶ç›´æ¥è¦†ç›–å½“å‰æ–‡ä»¶ï¼ˆæ…ç”¨ï¼ï¼‰
git checkout main -- miniprogram/pages/index/index.ts
```

---

## ğŸ“± åŠŸèƒ½ä¾èµ–å…³ç³»

### å¾®ä¿¡æ”¯ä»˜å®Œæ•´æµç¨‹
```
å‰ç«¯ï¼š
1. getUserOpenId() â†’ è·å–OpenID
2. selectPackage() â†’ ç”¨æˆ·é€‰æ‹©å¥—é¤
3. createPayment() â†’ åˆ›å»ºæ”¯ä»˜è®¢å•
4. callWeChatPay() â†’ è°ƒç”¨å¾®ä¿¡æ”¯ä»˜
5. updateUserPackage() â†’ æ›´æ–°ç”¨æˆ·å¥—é¤

åç«¯APIï¼š
1. POST /api/wechat/auth/openid
2. POST /api/wechat/pay/create
3. å¾®ä¿¡æ”¯ä»˜å›è°ƒï¼ˆåç«¯å¤„ç†ï¼‰
```

### ç”¨æˆ·ç³»ç»Ÿå®Œæ•´æµç¨‹
```
å‰ç«¯ï¼š
1. loadUserInfo() â†’ åŠ è½½å¤´åƒå’Œæ˜µç§°
2. loadUserStatus() â†’ åŠ è½½ç­‰çº§å’Œæ¬¡æ•°
3. checkUserRemainingCount() â†’ æ£€æŸ¥æ˜¯å¦å¯ç”¨
4. enhanceImage() â†’ æ‰§è¡Œå›¾ç‰‡å¤„ç†
5. useOneTime() â†’ æ‰£é™¤ä¸€æ¬¡ä½¿ç”¨æ¬¡æ•°

æœ¬åœ°å­˜å‚¨ï¼š
- userAvatar
- userNickname
- userLevel
- remainingCount
- openid
```

---

## âš ï¸ é‡è¦æç¤º

### æ¢å¤é¡µé¢åå¿…é¡»åšçš„äº‹æƒ…

1. **ä¿®æ”¹app.json**
   ```json
   {
     "pages": [
       "pages/splash/splash",
       "pages/home/home",        // æ–°å¢
       "pages/index/index",
       // ... å…¶ä»–é¡µé¢
     ]
   }
   ```

2. **ä¿®æ”¹å¯åŠ¨é¡µè·³è½¬**
   ```javascript
   // splash/splash.ts
   url: '/pages/home/home'  // ä»indexæ”¹ä¸ºhome
   ```

3. **æµ‹è¯•é¡µé¢è·³è½¬**
   - å¯åŠ¨é¡µ â†’ é¦–é¡µ âœ“
   - é¦–é¡µ â†’ å„åŠŸèƒ½é¡µ âœ“
   - è¿”å›å¯¼èˆª âœ“

### æ¢å¤æ”¯ä»˜åŠŸèƒ½åå¿…é¡»åšçš„äº‹æƒ…

1. **ç¡®è®¤åç«¯APIå¯ç”¨**
   - `/api/wechat/auth/openid`
   - `/api/wechat/pay/create`

2. **é…ç½®å¾®ä¿¡æ”¯ä»˜**
   - å•†æˆ·å·é…ç½®
   - æ”¯ä»˜å¯†é’¥é…ç½®
   - æ”¯ä»˜å›è°ƒURL

3. **æµ‹è¯•æ”¯ä»˜æµç¨‹**
   - OpenIDè·å– âœ“
   - è®¢å•åˆ›å»º âœ“
   - æ”¯ä»˜è°ƒç”¨ âœ“
   - æ”¯ä»˜å›è°ƒ âœ“

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [åŠŸèƒ½å®ç°è®°å½•ä¸æ¢å¤æŒ‡å—.md](./åŠŸèƒ½å®ç°è®°å½•ä¸æ¢å¤æŒ‡å—.md) - è¯¦ç»†çš„åŠŸèƒ½è¯´æ˜å’Œä»£ç ç¤ºä¾‹
- [V1-MVP-å®ç°æ€»ç»“.md](./V1-MVP-å®ç°æ€»ç»“.md) - V1ç‰ˆæœ¬çš„å®ç°æ€»ç»“
- [README.md](./README.md) - é¡¹ç›®æ€»è§ˆ
- [å¾®ä¿¡å°ç¨‹åºè°ƒç”¨æŒ‡å—.md](./å¾®ä¿¡å°ç¨‹åºè°ƒç”¨æŒ‡å—.md) - APIè°ƒç”¨æ–‡æ¡£
- [å¾®ä¿¡æ”¯ä»˜APIè°ƒç”¨æŒ‡å—.md](./å¾®ä¿¡æ”¯ä»˜APIè°ƒç”¨æŒ‡å—.md) - æ”¯ä»˜é›†æˆæ–‡æ¡£

---

**æ›´æ–°æ—¶é—´**ï¼š2025å¹´10æœˆ1æ—¥

