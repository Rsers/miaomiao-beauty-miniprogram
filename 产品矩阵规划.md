# å°ç¨‹åºäº§å“çŸ©é˜µå¼€å‘è®¡åˆ’

**åˆ›å»ºæ—¶é—´ï¼š** 2025-10-31  
**çŠ¶æ€ï¼š** è§„åˆ’ä¸­  
**ç›®æ ‡ï¼š** æ„å»ºä¸€ä¸ªä»¥å…¬ä¼—å·ä¸ºæ¢çº½çš„å°ç¨‹åºçŸ©é˜µï¼Œå®ç°æµé‡äº’å¯¼å’Œä¼šå‘˜ä½“ç³»æ‰“é€š

---

## ğŸ“‹ ç›®å½•

1. [æ ¸å¿ƒæƒ³æ³•](#æ ¸å¿ƒæƒ³æ³•)
2. [æŠ€æœ¯å¯è¡Œæ€§åˆ†æ](#æŠ€æœ¯å¯è¡Œæ€§åˆ†æ)
3. [å…·ä½“å®æ–½æ–¹æ¡ˆ](#å…·ä½“å®æ–½æ–¹æ¡ˆ)
4. [ä»£ç ç¤ºä¾‹](#ä»£ç ç¤ºä¾‹)
5. [åˆ†é˜¶æ®µå®æ–½è®¡åˆ’](#åˆ†é˜¶æ®µå®æ–½è®¡åˆ’)
6. [é£é™©ä¸æ³¨æ„äº‹é¡¹](#é£é™©ä¸æ³¨æ„äº‹é¡¹)

---

## ğŸ’¡ æ ¸å¿ƒæƒ³æ³•

### äº§å“çŸ©é˜µå¸ƒå±€

```
                    ã€å¾®ä¿¡å…¬ä¼—å·ã€‘
                    ï¼ˆæµé‡ä¸­å¿ƒæ¢çº½ï¼‰
                           |
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        |                  |                  |
   ã€å–µå–µç¾é¢œã€‘        ã€PDFè½¬JPGã€‘        ã€ç­”é¢˜å°ç¨‹åºã€‘
   å›¾ç‰‡å¢å¼ºå·¥å…·         æ–‡æ¡£å·¥å…·ç±»          çŸ¥è¯†é—®ç­”ç±»
        |                  |                  |
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           |
                    ã€å°æ¸¸æˆç³»åˆ—ã€‘
                    ä¼‘é—²æ¸¸æˆ + å¹¿å‘Š
```

### æ ¸å¿ƒæœºåˆ¶

1. **å…¬ä¼—å·ä½œä¸ºæ¢çº½**
   - å‘å¸ƒä»»åŠ¡ã€å‘æ”¾å…‘æ¢ç 
   - æ•´ç‚¹æŠ¢åˆ¸ï¼ˆæ¯å¤©å›ºå®šæ—¶é—´åˆ·æ–°é¢åº¦æ± ï¼‰
   - ä¸²è”æ‰€æœ‰å°ç¨‹åºå’Œå°æ¸¸æˆ

2. **ç»Ÿä¸€ä¼šå‘˜ä½“ç³»**
   - ä»»ä½•ä¸€ä¸ªå°ç¨‹åºçš„ä»˜è´¹ä¼šå‘˜ï¼Œæ‰€æœ‰å·¥å…·éƒ½å¯ä»¥é€šç”¨
   - åŸºäº UnionID è¯†åˆ«åŒä¸€ç”¨æˆ·

3. **å¤šå…ƒåŒ–è·å–é¢åº¦**
   - å…³æ³¨å…¬ä¼—å·ï¼š+50 æ¬¡
   - æ•´ç‚¹æŠ¢åˆ¸ï¼šå…ˆåˆ°å…ˆå¾—ï¼ˆå¦‚æ¯å¤©12:00åˆ·æ–°100ä¸ªåé¢ï¼Œæ¯ä¸ª+50æ¬¡ï¼‰
   - å°æ¸¸æˆé—¯å…³ï¼šé€šå…³å¼¹å‡ºå…‘æ¢ç 
   - ç­”é¢˜ä»»åŠ¡ï¼šç­”å¯¹ä¸€å®šæ•°é‡è·å¾—å…‘æ¢ç 
   - è§‚çœ‹è§†é¢‘å¹¿å‘Šï¼š+5 æ¬¡
   - åˆ†äº«ç»™å¥½å‹ï¼šåŒæ–¹å„ +10 æ¬¡

4. **è£‚å˜åˆ†äº«æœºåˆ¶ï¼ˆéœ€è°¨æ…ï¼‰**
   - Aç”¨æˆ·ä»˜è´¹ä¼šå‘˜ â†’ è·å¾—1ä¸ªèµ é€åé¢ï¼ˆ15å¤©ä¼šå‘˜ï¼Œä»…é™èµ é€ï¼Œ7å¤©æœ‰æ•ˆæœŸï¼‰
   - Bæ¥æ”¶ â†’ è·å¾—15å¤©å…è´¹ä¼šå‘˜ + æ–°çš„èµ é€åé¢ï¼ˆ7å¤©ä¼šå‘˜ï¼‰
   - Cæ¥æ”¶ â†’ è·å¾—7å¤©å…è´¹ä¼šå‘˜ + æ–°çš„èµ é€åé¢ï¼ˆ3å¤©ä¼šå‘˜ï¼‰
   - Dæ¥æ”¶ â†’ è·å¾—3å¤©ä¼šå‘˜ + æ–°çš„èµ é€åé¢ï¼ˆ1å¤©ä¼šå‘˜ï¼‰
   - Eæ¥æ”¶ â†’ è·å¾—1å¤©ä¼šå‘˜ï¼ˆé“¾æ¡ç»“æŸï¼‰

5. **é¥¥é¥¿è¥é”€**
   - æ•´ç‚¹æŠ¢åˆ¸ï¼šé™æ—¶é™é‡ï¼Œå¢åŠ ç´§è¿«æ„Ÿ
   - ç¤¾äº¤è¯æ˜ï¼š"ğŸ”¥ å·²æœ‰ 23 äººé¢†å–ï¼Œæ‰‹æ…¢æ— ï¼"
   - æ´»åŠ¨æé†’ï¼šè®¢é˜…æ¶ˆæ¯æé†’ç”¨æˆ·"10åˆ†é’Ÿåå¼€æŠ¢"

---

## ğŸ” æŠ€æœ¯å¯è¡Œæ€§åˆ†æ

### 1. å…¬ä¼—å·å…³æ³¨æ£€æµ‹

#### âŒ æ— æ³•ç›´æ¥æ£€æµ‹
- å°ç¨‹åºæ— æ³•ç›´æ¥è°ƒç”¨ API æŸ¥è¯¢ç”¨æˆ·æ˜¯å¦å…³æ³¨å…¬ä¼—å·
- å¿…é¡»é€šè¿‡å…¬ä¼—å·ä¸»åŠ¨é€šçŸ¥æˆ–ç”¨æˆ·æ“ä½œæ¥ç¡®è®¤

#### âœ… å¯è¡Œæ–¹æ¡ˆ

**æ–¹æ¡ˆ1ï¼šå…¬ä¼—å·èœå•è·³è½¬ï¼ˆæ¨èï¼‰â­**
```
æµç¨‹ï¼š
1. ç”¨æˆ·å…³æ³¨å…¬ä¼—å·
2. ç‚¹å‡»å…¬ä¼—å·èœå•"é¢†å–50æ¬¡é¢åº¦"
3. è·³è½¬å°ç¨‹åºæ—¶æºå¸¦ openid/unionid
4. å°ç¨‹åºéªŒè¯èº«ä»½ â†’ å‘æ”¾50æ¬¡

ä¼˜ç‚¹ï¼š
- å¯é æ€§é«˜
- ç”¨æˆ·ä½“éªŒå¥½
- æ— éœ€é¢å¤–éªŒè¯

å®ç°ï¼š
- å…¬ä¼—å·åå°è®¾ç½®è‡ªå®šä¹‰èœå•
- èœå•è·³è½¬é“¾æ¥æºå¸¦å‚æ•°ï¼šweixin://wxaurl?path=pages/index/index&from=gzh&openid=xxx
```

**æ–¹æ¡ˆ2ï¼šéªŒè¯ç æœºåˆ¶ï¼ˆæœ€ç®€å•ï¼‰â­â­**
```
æµç¨‹ï¼š
1. ç”¨æˆ·åœ¨å°ç¨‹åºå†…ç‚¹å‡»"å…³æ³¨å…¬ä¼—å·é¢†50æ¬¡"
2. æ˜¾ç¤ºå…¬ä¼—å·äºŒç»´ç 
3. ç”¨æˆ·å…³æ³¨åï¼Œåœ¨å…¬ä¼—å·å›å¤å…³é”®è¯"é¢†å–é¢åº¦"
4. å…¬ä¼—å·è‡ªåŠ¨å›å¤éªŒè¯ç ï¼ˆ6ä½æ•°å­—ï¼‰
5. ç”¨æˆ·åœ¨å°ç¨‹åºè¾“å…¥éªŒè¯ç 
6. éªŒè¯é€šè¿‡ â†’ å‘æ”¾50æ¬¡

ä¼˜ç‚¹ï¼š
- ç®€å•æ˜“å®ç°
- æ— éœ€å¤æ‚çš„å‚æ•°ä¼ é€’
- ç”¨æˆ·å¯ä»¥éšæ—¶éªŒè¯

å®ç°ï¼š
- æœåŠ¡ç«¯ç”ŸæˆéªŒè¯ç ï¼ˆ6ä½æ•°å­—ï¼Œ5åˆ†é’Ÿæœ‰æ•ˆï¼‰
- Redis å­˜å‚¨ï¼šcode:123456 â†’ {userId: xxx, expireAt: xxx}
- å°ç¨‹åºè¾“å…¥éªŒè¯ç  â†’ æœåŠ¡ç«¯éªŒè¯ â†’ å‘æ”¾é¢åº¦
```

**æ–¹æ¡ˆ3ï¼šå¸¦å‚æ•°äºŒç»´ç **
```
æµç¨‹ï¼š
1. å°ç¨‹åºç”Ÿæˆä¸“å±äºŒç»´ç ï¼ˆå¸¦ç”¨æˆ·æ ‡è¯†ï¼‰
2. ç”¨æˆ·æ‰«ç å…³æ³¨å…¬ä¼—å·
3. å…¬ä¼—å·åå°æ¥æ”¶ subscribe äº‹ä»¶ï¼ˆæºå¸¦ç”¨æˆ·æ ‡è¯†ï¼‰
4. æœåŠ¡ç«¯æ ‡è®°è¯¥ç”¨æˆ·å·²å…³æ³¨
5. å°ç¨‹åºè½®è¯¢æŸ¥è¯¢çŠ¶æ€ â†’ å‘æ”¾é¢åº¦

ä¼˜ç‚¹ï¼š
- å¯ä»¥ç²¾ç¡®è¿½è¸ªæ¯ä¸ªç”¨æˆ·

ç¼ºç‚¹ï¼š
- éœ€è¦ç”Ÿæˆå¤§é‡äºŒç»´ç 
- å°ç¨‹åºéœ€è¦è½®è¯¢
```

**æ¨èï¼šæ–¹æ¡ˆ2ï¼ˆéªŒè¯ç æœºåˆ¶ï¼‰**
- æœ€ç®€å•ã€æœ€å¯é 
- ç”¨æˆ·ä½“éªŒå¥½
- æˆæœ¬ä½

---

### 2. å–å…³æ£€æµ‹ & åå¤å…³æ³¨-å–å…³

#### âœ… å®Œå…¨å¯ä»¥æ£€æµ‹

**å¾®ä¿¡äº‹ä»¶æ¨é€ï¼š**
```javascript
// å…¬ä¼—å·åå°æ¥æ”¶å¾®ä¿¡äº‹ä»¶
{
  event: 'subscribe',   // å…³æ³¨äº‹ä»¶
  openid: 'xxx',
  timestamp: 1698825600
}

{
  event: 'unsubscribe', // å–å…³äº‹ä»¶
  openid: 'xxx',
  timestamp: 1698826000
}
```

**åä½œå¼Šç­–ç•¥ï¼š**

1. **è®°å½•ç”¨æˆ·å…³æ³¨å†å²**
   ```typescript
   interface UserFollowHistory {
     openid: string;
     unionid: string;
     actions: {
       type: 'subscribe' | 'unsubscribe';
       timestamp: number;
     }[];
     rewardCount: number; // å·²é¢†å–å¥–åŠ±æ¬¡æ•°
   }
   ```

2. **æ£€æµ‹å¼‚å¸¸è¡Œä¸º**
   ```typescript
   function isAbnormalBehavior(history: UserFollowHistory): boolean {
     const last7Days = history.actions.filter(
       a => a.timestamp > Date.now() - 7 * 24 * 3600 * 1000
     );
     
     const subscribeCount = last7Days.filter(a => a.type === 'subscribe').length;
     
     // 7å¤©å†…å…³æ³¨-å–å…³è¶…è¿‡3æ¬¡
     if (subscribeCount > 3) {
       return true;
     }
     
     // å…³æ³¨å10åˆ†é’Ÿå†…å–å…³
     for (let i = 0; i < history.actions.length - 1; i++) {
       if (history.actions[i].type === 'subscribe' && 
           history.actions[i+1].type === 'unsubscribe' &&
           history.actions[i+1].timestamp - history.actions[i].timestamp < 600000) {
         return true;
       }
     }
     
     return false;
   }
   ```

3. **é™åˆ¶å¥–åŠ±**
   ```typescript
   async function handleSubscribe(openid: string) {
     const history = await getFollowHistory(openid);
     
     // æ£€æµ‹å¼‚å¸¸
     if (isAbnormalBehavior(history)) {
       console.log('æ£€æµ‹åˆ°å¼‚å¸¸è¡Œä¸ºï¼Œä¸å‘æ”¾å¥–åŠ±');
       return;
     }
     
     // é™åˆ¶å¥–åŠ±æ¬¡æ•°ï¼ˆå¦‚æ¯ä¸ªç”¨æˆ·åªèƒ½é¢†å–1æ¬¡ï¼‰
     if (history.rewardCount >= 1) {
       console.log('è¯¥ç”¨æˆ·å·²é¢†å–è¿‡å¥–åŠ±');
       return;
     }
     
     // å‘æ”¾å¥–åŠ±
     await grantQuota(openid, 50);
     history.rewardCount++;
     await saveFollowHistory(history);
   }
   ```

**å–å…³åçš„å¤„ç†ï¼š**
- âœ… å¯ä»¥æ”¶å›å·²å‘æ”¾çš„é¢åº¦ï¼ˆå¦‚æœæ£€æµ‹åˆ°å–å…³ï¼‰
- âš ï¸ ä½†æ³¨æ„ï¼šç”¨æˆ·å–å…³åï¼Œå…¬ä¼—å·æ— æ³•ä¸»åŠ¨ç»™ç”¨æˆ·å‘æ¶ˆæ¯ï¼ˆé™¤é48å°æ—¶å†…æœ‰äº’åŠ¨ï¼‰

---

### 3. æ•´ç‚¹æŠ¢åˆ¸ + æ¶ˆæ¯æé†’

#### âœ… å¯ä»¥å®ç°

**å°ç¨‹åºè®¢é˜…æ¶ˆæ¯ï¼ˆæ¨èï¼‰ï¼š**
```typescript
// å‰ç«¯ï¼šç”¨æˆ·æˆæƒè®¢é˜…
wx.requestSubscribeMessage({
  tmplIds: ['æ•´ç‚¹æŠ¢åˆ¸æé†’æ¨¡æ¿ID'],
  success: (res) => {
    if (res['æ•´ç‚¹æŠ¢åˆ¸æé†’æ¨¡æ¿ID'] === 'accept') {
      // ç”¨æˆ·åŒæ„æ¥æ”¶æé†’
      // æœåŠ¡ç«¯è®°å½•ï¼Œå®šæ—¶æ¨é€
    }
  }
})

// åç«¯ï¼šå®šæ—¶æ¨é€ï¼ˆå¦‚æ¯å¤©11:50ï¼‰
await sendSubscribeMessage({
  touser: 'openid',
  template_id: 'æ•´ç‚¹æŠ¢åˆ¸æé†’æ¨¡æ¿ID',
  page: 'pages/index/index',
  data: {
    thing1: { value: 'æ•´ç‚¹æŠ¢åˆ¸æ´»åŠ¨' },
    time2: { value: '2025-10-31 12:00' },
    thing3: { value: '100ä¸ªåé¢ï¼Œå…ˆåˆ°å…ˆå¾—' }
  }
})
```

**å…¬ä¼—å·æœåŠ¡é€šçŸ¥ï¼ˆå—é™ï¼‰ï¼š**
- âš ï¸ éœ€è¦ç”¨æˆ·48å°æ—¶å†…ä¸å…¬ä¼—å·æœ‰äº’åŠ¨
- âš ï¸ æˆ–ä½¿ç”¨"ä¸€æ¬¡æ€§è®¢é˜…æ¶ˆæ¯"ï¼ˆéœ€ç”¨æˆ·ä¸»åŠ¨è®¢é˜…ï¼‰

**æ¨èæ–¹æ¡ˆï¼š**
1. å°ç¨‹åºè®¢é˜…æ¶ˆæ¯ï¼ˆæå‰10åˆ†é’Ÿæé†’ï¼‰
2. å…¬ä¼—å·æ¯å¤©æ¨é€ä¸€ç¯‡æ–‡ç« ï¼ˆå¦‚æ¯å¤©11:00æ¨é€"ä»Šæ—¥æ•´ç‚¹ç¦åˆ©"ï¼‰

---

### 4. ç¤¾äº¤è¯æ˜ï¼ˆ"å·²æœ‰23äººé¢†å–"ï¼‰

#### âœ… å®Œå…¨å¯è¡Œ

**å®æ—¶ç»Ÿè®¡ï¼š**
```typescript
// Redis å®æ—¶è®¡æ•°
const key = `coupons:claimed:${new Date().toDateString()}:12:00`;

// æ¯æ¬¡é¢†å–æ—¶å¢åŠ 
await redis.incr(key);

// æŸ¥è¯¢
const claimedCount = await redis.get(key) || 0;

// å‰ç«¯æ˜¾ç¤º
"ğŸ”¥ å·²æœ‰ {{claimedCount}} äººé¢†å–ï¼Œæ‰‹æ…¢æ— ï¼"
```

**è¿›åº¦æ¡æ˜¾ç¤ºï¼š**
```typescript
// æ€»åé¢
const total = 100;

// å·²é¢†å–
const claimed = await redis.get(key) || 0;

// å‰©ä½™
const remaining = total - claimed;

// å‰ç«¯æ˜¾ç¤º
"â° ä»…å‰© {{remaining}} ä¸ªåé¢ï¼ˆ{{Math.floor(claimed/total*100)}}% å·²è¢«æŠ¢ï¼‰"
```

**é¢†å–åŠ¨æ€ï¼š**
```typescript
// è®°å½•æœ€è¿‘é¢†å–çš„ç”¨æˆ·ï¼ˆè„±æ•ï¼‰
await redis.lpush(`coupons:recent:${date}`, {
  nickname: '***123',
  timestamp: Date.now()
});

// å‰ç«¯æ˜¾ç¤ºï¼ˆæ»šåŠ¨æ’­æŠ¥ï¼‰
"ğŸ‰ æ­å–œç”¨æˆ· ***123 é¢†å–æˆåŠŸ"
"ğŸ‰ æ­å–œç”¨æˆ· ***456 é¢†å–æˆåŠŸ"
```

---

### 5. è£‚å˜åˆ†äº«æœºåˆ¶ï¼ˆä¼šå‘˜é€’å‡èµ é€ï¼‰

#### âœ… æŠ€æœ¯ä¸Šå®Œå…¨å¯è¡Œ

**èµ é€è§„åˆ™ï¼š**
```typescript
const GIFT_RULES = {
  level1: { days: 15, nextLevel: 'level2', expireDays: 7 }, // Aèµ é€15å¤©
  level2: { days: 7,  nextLevel: 'level3', expireDays: 7 }, // Bèµ é€7å¤©
  level3: { days: 3,  nextLevel: 'level4', expireDays: 7 }, // Cèµ é€3å¤©
  level4: { days: 1,  nextLevel: null,     expireDays: 7 }, // Dèµ é€1å¤©ï¼Œé“¾æ¡ç»“æŸ
};
```

**æ•°æ®ç»“æ„ï¼š**
```typescript
interface GiftQuota {
  userId: string;
  level: 'level1' | 'level2' | 'level3' | 'level4';
  days: number;          // å¯èµ é€çš„å¤©æ•°
  expireAt: number;      // è¿‡æœŸæ—¶é—´ï¼ˆ7å¤©åï¼‰
  used: boolean;         // æ˜¯å¦å·²ä½¿ç”¨
  usedAt?: number;       // ä½¿ç”¨æ—¶é—´
  giftedTo?: string;     // èµ é€ç»™è°
}

interface Membership {
  userId: string;
  type: 'paid' | 'gift';      // ä»˜è´¹ä¼šå‘˜ or èµ é€ä¼šå‘˜
  expireAt: number;           // ä¼šå‘˜åˆ°æœŸæ—¶é—´
  giftFrom?: string;          // å¦‚æœæ˜¯èµ é€ï¼Œæ¥è‡ªè°
  giftLevel?: string;         // èµ é€ç­‰çº§
}
```

**æ ¸å¿ƒé€»è¾‘ï¼š**
```typescript
// ä»˜è´¹åç”Ÿæˆèµ é€åé¢
async function onUserPurchase(userId: string) {
  // 1. å¼€é€šä¼šå‘˜
  await grantMembership(userId, 'paid', 30); // 30å¤©ä»˜è´¹ä¼šå‘˜
  
  // 2. ç”Ÿæˆèµ é€åé¢
  await createGiftQuota({
    userId,
    level: 'level1',
    days: 15,
    expireAt: Date.now() + 7 * 24 * 3600 * 1000, // 7å¤©åè¿‡æœŸ
    used: false
  });
  
  // 3. é€šçŸ¥ç”¨æˆ·
  await sendNotification(userId, 'æ‚¨è·å¾—äº†1ä¸ª15å¤©ä¼šå‘˜èµ é€åé¢ï¼Œå¿«å»åˆ†äº«ç»™å¥½å‹å§ï¼');
}

// èµ é€ä¼šå‘˜
async function sendGift(fromUserId: string, toUserId: string) {
  // 1. æ£€æŸ¥å‘é€è€…æ˜¯å¦æœ‰èµ é€èµ„æ ¼
  const gift = await getGiftQuota(fromUserId);
  
  if (!gift) {
    throw new Error('æ‚¨æš‚æ— èµ é€åé¢');
  }
  
  if (gift.used) {
    throw new Error('è¯¥èµ é€åé¢å·²ä½¿ç”¨');
  }
  
  if (gift.expireAt < Date.now()) {
    throw new Error('èµ é€åé¢å·²è¿‡æœŸ');
  }
  
  // 2. æ£€æŸ¥æ¥æ”¶è€…æ˜¯å¦å·²ç»æ˜¯ä¼šå‘˜
  const membership = await getMembership(toUserId);
  if (membership && membership.expireAt > Date.now()) {
    throw new Error('å¯¹æ–¹å·²ç»æ˜¯ä¼šå‘˜äº†');
  }
  
  // 3. å‘æ”¾ä¼šå‘˜ç»™æ¥æ”¶è€…
  await grantMembership(toUserId, 'gift', gift.days, fromUserId, gift.level);
  
  // 4. ç»™æ¥æ”¶è€…ç”Ÿæˆæ–°çš„èµ é€åé¢ï¼ˆé€’å‡ï¼‰
  const nextLevel = GIFT_RULES[gift.level].nextLevel;
  if (nextLevel) {
    await createGiftQuota({
      userId: toUserId,
      level: nextLevel,
      days: GIFT_RULES[nextLevel].days,
      expireAt: Date.now() + 7 * 24 * 3600 * 1000,
      used: false
    });
  }
  
  // 5. æ ‡è®°å‘é€è€…çš„åé¢å·²ä½¿ç”¨
  await markGiftUsed(gift.id, toUserId);
  
  // 6. é€šçŸ¥åŒæ–¹
  await sendNotification(fromUserId, `æ‚¨å·²æˆåŠŸèµ é€${gift.days}å¤©ä¼šå‘˜ç»™å¥½å‹ï¼`);
  await sendNotification(toUserId, `æ­å–œè·å¾—${gift.days}å¤©å…è´¹ä¼šå‘˜ï¼${nextLevel ? 'æ‚¨ä¹Ÿè·å¾—äº†æ–°çš„èµ é€åé¢ï¼' : ''}`);
}
```

#### âš ï¸ åˆè§„é£é™©

**å¾®ä¿¡ä¸¥æ ¼ç¦æ­¢"è¯±å¯¼åˆ†äº«"ï¼š**
- âŒ "å¿…é¡»åˆ†äº«ç»™5ä¸ªå¥½å‹æ‰èƒ½è§£é”" â†’ è¿è§„
- âŒ "åˆ†äº«åˆ°æœ‹å‹åœˆæ‰èƒ½ç»§ç»­ä½¿ç”¨" â†’ è¿è§„
- âŒ "åˆ†äº«åæ˜¾ç¤ºç­”æ¡ˆ" â†’ è¿è§„

**å»ºè®®æ”¹ä¸ºï¼š**
- âœ… "å¯ä»¥èµ é€ï¼Œä½†ä¸å¼ºåˆ¶"
- âœ… "èµ é€åè‡ªå·±ä¹Ÿæœ‰å¥–åŠ±"ï¼ˆè€Œä¸æ˜¯"åªèƒ½åˆ«äººç”¨"ï¼‰
- âœ… ç”¨æˆ·å¯ä»¥é€‰æ‹©"åˆ†äº«"æˆ–"çœ‹å¹¿å‘Š"ç­‰å¤šç§æ–¹å¼è·å–

**ä¿®æ”¹åçš„å®‰å…¨æ–¹æ¡ˆï¼š**
```typescript
// ä»˜è´¹åçš„å¥–åŠ±
async function onUserPurchase(userId: string) {
  // 1. å¼€é€šä¼šå‘˜
  await grantMembership(userId, 'paid', 30);
  
  // 2. è‡ªå·±ä¹Ÿè·å¾—é¢å¤–10å¤©ä¼šå‘˜
  await extendMembership(userId, 10);
  
  // 3. ç”Ÿæˆèµ é€åé¢ï¼ˆå¯é€‰ï¼‰
  await createGiftQuota({
    userId,
    level: 'level1',
    days: 15,
    expireAt: Date.now() + 7 * 24 * 3600 * 1000,
    used: false
  });
  
  // 4. é€šçŸ¥ç”¨æˆ·ï¼ˆå¼ºè°ƒ"å¯ä»¥"è€Œä¸æ˜¯"å¿…é¡»"ï¼‰
  await sendNotification(userId, 
    'æ„Ÿè°¢è´­ä¹°ä¼šå‘˜ï¼\n' +
    'ğŸ æ‚¨å·²è·å¾—30å¤©ä¼šå‘˜ + 10å¤©å¥–åŠ±\n' +
    'ğŸ’ è¿˜å¯ä»¥èµ é€15å¤©ä¼šå‘˜ç»™å¥½å‹ï¼ˆå¯é€‰ï¼‰'
  );
}
```

---

## ğŸ› ï¸ å…·ä½“å®æ–½æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šå…¬ä¼—å·å…³æ³¨éªŒè¯ï¼ˆéªŒè¯ç æœºåˆ¶ï¼‰

#### æ•°æ®åº“è®¾è®¡

```sql
-- éªŒè¯ç è¡¨
CREATE TABLE verification_codes (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  code VARCHAR(6) NOT NULL,           -- éªŒè¯ç ï¼ˆ6ä½æ•°å­—ï¼‰
  user_id VARCHAR(64) NOT NULL,        -- å°ç¨‹åºç”¨æˆ·IDï¼ˆdeviceIdï¼‰
  openid VARCHAR(64),                  -- å…¬ä¼—å· openidï¼ˆéªŒè¯åå¡«å……ï¼‰
  unionid VARCHAR(64),                 -- unionidï¼ˆç”¨äºè·¨åº”ç”¨è¯†åˆ«ï¼‰
  type VARCHAR(20) NOT NULL,           -- ç±»å‹ï¼šfollow_rewardï¼ˆå…³æ³¨å¥–åŠ±ï¼‰
  status VARCHAR(20) NOT NULL,         -- çŠ¶æ€ï¼špending/used/expired
  reward_value INT NOT NULL,           -- å¥–åŠ±å€¼ï¼ˆå¦‚50æ¬¡ï¼‰
  created_at BIGINT NOT NULL,          -- åˆ›å»ºæ—¶é—´
  expire_at BIGINT NOT NULL,           -- è¿‡æœŸæ—¶é—´ï¼ˆ5åˆ†é’Ÿï¼‰
  used_at BIGINT,                      -- ä½¿ç”¨æ—¶é—´
  INDEX idx_code (code),
  INDEX idx_user_id (user_id),
  INDEX idx_openid (openid)
);

-- å…³æ³¨å†å²è¡¨
CREATE TABLE follow_history (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  openid VARCHAR(64) NOT NULL,
  unionid VARCHAR(64),
  event_type VARCHAR(20) NOT NULL,     -- subscribe/unsubscribe
  timestamp BIGINT NOT NULL,
  reward_granted BOOLEAN DEFAULT FALSE, -- æ˜¯å¦å·²å‘æ”¾å¥–åŠ±
  INDEX idx_openid (openid),
  INDEX idx_unionid (unionid),
  INDEX idx_timestamp (timestamp)
);
```

#### å‰ç«¯æµç¨‹ï¼ˆå°ç¨‹åºï¼‰

```typescript
// pages/follow-reward/follow-reward.ts

Page({
  data: {
    step: 1,              // æ­¥éª¤ï¼š1-ç”ŸæˆéªŒè¯ç , 2-ç­‰å¾…éªŒè¯, 3-å®Œæˆ
    code: '',             // éªŒè¯ç 
    qrcodeUrl: '',        // å…¬ä¼—å·äºŒç»´ç 
    inputCode: '',        // ç”¨æˆ·è¾“å…¥çš„éªŒè¯ç 
    countdown: 300,       // å€’è®¡æ—¶ï¼ˆ5åˆ†é’Ÿï¼‰
    checking: false       // æ˜¯å¦æ­£åœ¨éªŒè¯
  },
  
  onLoad() {
    this.generateCode();
    this.startCountdown();
  },
  
  // ç”ŸæˆéªŒè¯ç 
  async generateCode() {
    wx.showLoading({ title: 'ç”Ÿæˆä¸­...' });
    
    try {
      const res = await wx.request({
        url: 'https://your-api.com/api/verification/generate',
        method: 'POST',
        data: {
          userId: this.getDeviceId(),
          type: 'follow_reward'
        }
      });
      
      this.setData({
        code: res.data.code,
        qrcodeUrl: res.data.qrcodeUrl, // å…¬ä¼—å·äºŒç»´ç 
        step: 2
      });
      
      wx.hideLoading();
    } catch (error) {
      wx.hideLoading();
      wx.showToast({ title: 'ç”Ÿæˆå¤±è´¥', icon: 'none' });
    }
  },
  
  // å€’è®¡æ—¶
  startCountdown() {
    const timer = setInterval(() => {
      const countdown = this.data.countdown - 1;
      this.setData({ countdown });
      
      if (countdown <= 0) {
        clearInterval(timer);
        this.setData({ step: 1 });
        wx.showToast({ title: 'éªŒè¯ç å·²è¿‡æœŸ', icon: 'none' });
      }
    }, 1000);
  },
  
  // ç”¨æˆ·è¾“å…¥éªŒè¯ç 
  onInputChange(e: any) {
    this.setData({ inputCode: e.detail.value });
  },
  
  // éªŒè¯éªŒè¯ç 
  async verifyCode() {
    if (!this.data.inputCode || this.data.inputCode.length !== 6) {
      wx.showToast({ title: 'è¯·è¾“å…¥6ä½éªŒè¯ç ', icon: 'none' });
      return;
    }
    
    this.setData({ checking: true });
    
    try {
      const res = await wx.request({
        url: 'https://your-api.com/api/verification/verify',
        method: 'POST',
        data: {
          code: this.data.inputCode,
          userId: this.getDeviceId()
        }
      });
      
      if (res.data.success) {
        this.setData({ step: 3 });
        wx.showToast({ title: 'éªŒè¯æˆåŠŸï¼Œå·²å‘æ”¾50æ¬¡é¢åº¦ï¼', icon: 'success' });
        
        // 3ç§’åè¿”å›é¦–é¡µ
        setTimeout(() => {
          wx.navigateBack();
        }, 3000);
      } else {
        wx.showToast({ title: res.data.message || 'éªŒè¯å¤±è´¥', icon: 'none' });
      }
    } catch (error) {
      wx.showToast({ title: 'éªŒè¯å¤±è´¥', icon: 'none' });
    } finally {
      this.setData({ checking: false });
    }
  },
  
  // è·å–è®¾å¤‡ID
  getDeviceId(): string {
    let deviceId = wx.getStorageSync('device_uuid');
    if (!deviceId) {
      deviceId = 'device_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
      wx.setStorageSync('device_uuid', deviceId);
    }
    return deviceId;
  }
});
```

#### åç«¯æµç¨‹ï¼ˆæœåŠ¡ç«¯ï¼‰

```typescript
// ç”ŸæˆéªŒè¯ç 
app.post('/api/verification/generate', async (req, res) => {
  const { userId, type } = req.body;
  
  // 1. ç”Ÿæˆ6ä½æ•°å­—éªŒè¯ç 
  const code = Math.floor(100000 + Math.random() * 900000).toString();
  
  // 2. ä¿å­˜åˆ°æ•°æ®åº“
  await db.verification_codes.insert({
    code,
    user_id: userId,
    type,
    status: 'pending',
    reward_value: 50,
    created_at: Date.now(),
    expire_at: Date.now() + 5 * 60 * 1000 // 5åˆ†é’Ÿåè¿‡æœŸ
  });
  
  // 3. è¿”å›éªŒè¯ç å’Œå…¬ä¼—å·äºŒç»´ç 
  res.json({
    code,
    qrcodeUrl: 'https://your-cdn.com/qrcode.jpg' // å…¬ä¼—å·äºŒç»´ç 
  });
});

// éªŒè¯éªŒè¯ç 
app.post('/api/verification/verify', async (req, res) => {
  const { code, userId } = req.body;
  
  // 1. æŸ¥è¯¢éªŒè¯ç 
  const record = await db.verification_codes.findOne({
    code,
    user_id: userId,
    status: 'pending'
  });
  
  if (!record) {
    return res.json({ success: false, message: 'éªŒè¯ç æ— æ•ˆ' });
  }
  
  if (record.expire_at < Date.now()) {
    return res.json({ success: false, message: 'éªŒè¯ç å·²è¿‡æœŸ' });
  }
  
  if (!record.openid) {
    return res.json({ success: false, message: 'è¯·å…ˆåœ¨å…¬ä¼—å·å›å¤éªŒè¯ç ' });
  }
  
  // 2. æ£€æŸ¥æ˜¯å¦å·²é¢†å–è¿‡å¥–åŠ±
  const history = await db.follow_history.findOne({
    openid: record.openid,
    event_type: 'subscribe',
    reward_granted: true
  });
  
  if (history) {
    return res.json({ success: false, message: 'æ‚¨å·²ç»é¢†å–è¿‡å…³æ³¨å¥–åŠ±äº†' });
  }
  
  // 3. å‘æ”¾å¥–åŠ±
  await grantQuota(userId, record.reward_value);
  
  // 4. æ ‡è®°éªŒè¯ç å·²ä½¿ç”¨
  await db.verification_codes.update(
    { id: record.id },
    { status: 'used', used_at: Date.now() }
  );
  
  // 5. æ ‡è®°å…³æ³¨å†å²å·²å‘æ”¾å¥–åŠ±
  await db.follow_history.update(
    { openid: record.openid, event_type: 'subscribe' },
    { reward_granted: true }
  );
  
  res.json({ success: true });
});

// å…¬ä¼—å·åå°æ¥æ”¶ç”¨æˆ·æ¶ˆæ¯
app.post('/api/wechat/message', async (req, res) => {
  const { FromUserName: openid, Content: content } = req.body;
  
  // ç”¨æˆ·å›å¤äº†6ä½æ•°å­—
  if (/^\d{6}$/.test(content)) {
    // æŸ¥è¯¢éªŒè¯ç è®°å½•
    const record = await db.verification_codes.findOne({
      code: content,
      status: 'pending',
      openid: null // å°šæœªç»‘å®š openid
    });
    
    if (record && record.expire_at > Date.now()) {
      // ç»‘å®š openid
      await db.verification_codes.update(
        { id: record.id },
        { openid }
      );
      
      // å›å¤ç”¨æˆ·
      return res.send(`
        <xml>
          <ToUserName><![CDATA[${openid}]]></ToUserName>
          <FromUserName><![CDATA[your-gzh-id]]></FromUserName>
          <CreateTime>${Math.floor(Date.now() / 1000)}</CreateTime>
          <MsgType><![CDATA[text]]></MsgType>
          <Content><![CDATA[éªŒè¯æˆåŠŸï¼è¯·è¿”å›å°ç¨‹åºç»§ç»­æ“ä½œã€‚]]></Content>
        </xml>
      `);
    }
  }
  
  // å…³é”®è¯å›å¤
  if (content === 'é¢†å–é¢åº¦' || content === 'å…³æ³¨å¥–åŠ±') {
    return res.send(`
      <xml>
        <ToUserName><![CDATA[${openid}]]></ToUserName>
        <FromUserName><![CDATA[your-gzh-id]]></FromUserName>
        <CreateTime>${Math.floor(Date.now() / 1000)}</CreateTime>
        <MsgType><![CDATA[text]]></MsgType>
        <Content><![CDATA[
ğŸ“± é¢†å–æ­¥éª¤ï¼š
1. æ‰“å¼€"å–µå–µç¾é¢œ"å°ç¨‹åº
2. ç‚¹å‡»"å…³æ³¨é¢†50æ¬¡"æŒ‰é’®
3. è·å–éªŒè¯ç 
4. åœ¨å…¬ä¼—å·å›å¤éªŒè¯ç 
5. å›åˆ°å°ç¨‹åºå®ŒæˆéªŒè¯

å¿«å»è¯•è¯•å§ï¼
        ]]></Content>
      </xml>
    `);
  }
  
  res.send('success');
});

// å…¬ä¼—å·åå°æ¥æ”¶å…³æ³¨/å–å…³äº‹ä»¶
app.post('/api/wechat/event', async (req, res) => {
  const { Event: event, FromUserName: openid } = req.body;
  
  // è®°å½•å…³æ³¨å†å²
  await db.follow_history.insert({
    openid,
    event_type: event, // subscribe / unsubscribe
    timestamp: Date.now(),
    reward_granted: false
  });
  
  // å…³æ³¨äº‹ä»¶ï¼šå›å¤å¼•å¯¼
  if (event === 'subscribe') {
    return res.send(`
      <xml>
        <ToUserName><![CDATA[${openid}]]></ToUserName>
        <FromUserName><![CDATA[your-gzh-id]]></FromUserName>
        <CreateTime>${Math.floor(Date.now() / 1000)}</CreateTime>
        <MsgType><![CDATA[text]]></MsgType>
        <Content><![CDATA[
ğŸ‰ æ¬¢è¿å…³æ³¨è¶…æ¸…é­”æ³•å…¬ä¼—å·ï¼

ğŸ æ–°ç”¨æˆ·ç¦åˆ©ï¼š
å…³æ³¨å³å¯é¢†å– 50 æ¬¡å…è´¹é¢åº¦ï¼

ğŸ“ é¢†å–æ­¥éª¤ï¼š
1. å›å¤"é¢†å–é¢åº¦"è·å–è¯¦ç»†è¯´æ˜
2. æˆ–ç›´æ¥åœ¨å°ç¨‹åºå†…ç‚¹å‡»"å…³æ³¨é¢†50æ¬¡"

æœŸå¾…ä¸ä½ ä¸€èµ·å˜ç¾ï¼âœ¨
        ]]></Content>
      </xml>
    `);
  }
  
  // å–å…³äº‹ä»¶ï¼šæ£€æµ‹å¼‚å¸¸è¡Œä¸º
  if (event === 'unsubscribe') {
    const history = await db.follow_history.find({
      openid,
      timestamp: { $gt: Date.now() - 7 * 24 * 3600 * 1000 }
    });
    
    const subscribeCount = history.filter(h => h.event_type === 'subscribe').length;
    
    if (subscribeCount > 3) {
      console.log(`æ£€æµ‹åˆ°å¼‚å¸¸è¡Œä¸ºï¼š${openid} åœ¨7å¤©å†…å…³æ³¨-å–å…³è¶…è¿‡3æ¬¡`);
      // å¯ä»¥æ ‡è®°è¯¥ç”¨æˆ·ï¼Œé™åˆ¶åç»­å¥–åŠ±
    }
  }
  
  res.send('success');
});
```

---

### æ–¹æ¡ˆ2ï¼šæ•´ç‚¹æŠ¢åˆ¸ç³»ç»Ÿ

#### æ•°æ®åº“è®¾è®¡

```sql
-- æŠ¢åˆ¸æ´»åŠ¨è¡¨
CREATE TABLE coupon_events (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  date DATE NOT NULL,                  -- æ—¥æœŸï¼š2025-10-31
  time TIME NOT NULL,                  -- æ—¶é—´ï¼š12:00:00
  total_quota INT NOT NULL,            -- æ€»åé¢ï¼š100
  reward_value INT NOT NULL,           -- å¥–åŠ±å€¼ï¼š50æ¬¡
  claimed_count INT DEFAULT 0,         -- å·²é¢†å–æ•°é‡
  status VARCHAR(20) NOT NULL,         -- çŠ¶æ€ï¼špending/active/finished
  start_at BIGINT NOT NULL,            -- å¼€å§‹æ—¶é—´
  end_at BIGINT NOT NULL,              -- ç»“æŸæ—¶é—´
  created_at BIGINT NOT NULL,
  UNIQUE KEY uk_date_time (date, time)
);

-- é¢†å–è®°å½•è¡¨
CREATE TABLE coupon_claims (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  event_id BIGINT NOT NULL,
  user_id VARCHAR(64) NOT NULL,
  openid VARCHAR(64),
  unionid VARCHAR(64),
  reward_value INT NOT NULL,
  claimed_at BIGINT NOT NULL,
  INDEX idx_event_id (event_id),
  INDEX idx_user_id (user_id),
  UNIQUE KEY uk_event_user (event_id, user_id)
);
```

#### å®šæ—¶ä»»åŠ¡ï¼ˆæ¯å¤©åˆ›å»ºæ´»åŠ¨ï¼‰

```typescript
// æ¯å¤©å‡Œæ™¨00:10åˆ›å»ºä»Šå¤©çš„æŠ¢åˆ¸æ´»åŠ¨
cron.schedule('10 0 * * *', async () => {
  const today = new Date().toISOString().split('T')[0];
  
  // åˆ›å»º12:00çš„æ´»åŠ¨
  await db.coupon_events.insert({
    date: today,
    time: '12:00:00',
    total_quota: 100,
    reward_value: 50,
    claimed_count: 0,
    status: 'pending',
    start_at: new Date(`${today} 12:00:00`).getTime(),
    end_at: new Date(`${today} 12:30:00`).getTime(), // 30åˆ†é’Ÿå†…æœ‰æ•ˆ
    created_at: Date.now()
  });
  
  // åˆ›å»º18:00çš„æ´»åŠ¨
  await db.coupon_events.insert({
    date: today,
    time: '18:00:00',
    total_quota: 100,
    reward_value: 50,
    claimed_count: 0,
    status: 'pending',
    start_at: new Date(`${today} 18:00:00`).getTime(),
    end_at: new Date(`${today} 18:30:00`).getTime(),
    created_at: Date.now()
  });
  
  console.log(`âœ… å·²åˆ›å»º ${today} çš„æŠ¢åˆ¸æ´»åŠ¨`);
});

// æ¯åˆ†é’Ÿæ£€æŸ¥æ´»åŠ¨çŠ¶æ€
cron.schedule('* * * * *', async () => {
  const now = Date.now();
  
  // æ¿€æ´»åˆ°æ—¶é—´çš„æ´»åŠ¨
  await db.coupon_events.update(
    { status: 'pending', start_at: { $lte: now } },
    { status: 'active' }
  );
  
  // ç»“æŸè¿‡æœŸçš„æ´»åŠ¨
  await db.coupon_events.update(
    { status: 'active', end_at: { $lte: now } },
    { status: 'finished' }
  );
});
```

#### åç«¯API

```typescript
// è·å–å½“å‰æ´»åŠ¨ä¿¡æ¯
app.get('/api/coupon/current', async (req, res) => {
  const now = Date.now();
  
  // æŸ¥è¯¢å½“å‰è¿›è¡Œä¸­çš„æ´»åŠ¨
  const event = await db.coupon_events.findOne({
    status: 'active',
    start_at: { $lte: now },
    end_at: { $gte: now }
  });
  
  if (!event) {
    // æŸ¥è¯¢ä¸‹ä¸€åœºæ´»åŠ¨
    const nextEvent = await db.coupon_events.findOne({
      status: 'pending',
      start_at: { $gt: now }
    }, {
      sort: { start_at: 1 }
    });
    
    return res.json({
      status: 'waiting',
      nextEvent: nextEvent ? {
        startAt: nextEvent.start_at,
        totalQuota: nextEvent.total_quota,
        rewardValue: nextEvent.reward_value
      } : null
    });
  }
  
  // ä»Redisè·å–å®æ—¶æ•°æ®
  const claimedCount = await redis.get(`coupon:claimed:${event.id}`) || 0;
  const remaining = event.total_quota - claimedCount;
  
  res.json({
    status: 'active',
    event: {
      id: event.id,
      totalQuota: event.total_quota,
      claimedCount: parseInt(claimedCount),
      remaining: remaining > 0 ? remaining : 0,
      rewardValue: event.reward_value,
      endAt: event.end_at
    }
  });
});

// æŠ¢åˆ¸
app.post('/api/coupon/claim', async (req, res) => {
  const { userId } = req.body;
  const now = Date.now();
  
  // 1. æŸ¥è¯¢å½“å‰æ´»åŠ¨
  const event = await db.coupon_events.findOne({
    status: 'active',
    start_at: { $lte: now },
    end_at: { $gte: now }
  });
  
  if (!event) {
    return res.json({ success: false, message: 'å½“å‰æ²¡æœ‰è¿›è¡Œä¸­çš„æ´»åŠ¨' });
  }
  
  // 2. æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²é¢†å–
  const claimed = await db.coupon_claims.findOne({
    event_id: event.id,
    user_id: userId
  });
  
  if (claimed) {
    return res.json({ success: false, message: 'æ‚¨å·²ç»é¢†å–è¿‡äº†' });
  }
  
  // 3. RedisåŸå­æ“ä½œï¼ˆé˜²æ­¢è¶…å‘ï¼‰
  const key = `coupon:claimed:${event.id}`;
  const claimedCount = await redis.incr(key);
  
  if (claimedCount > event.total_quota) {
    // è¶…è¿‡åé¢ï¼Œå›é€€
    await redis.decr(key);
    return res.json({ success: false, message: 'åé¢å·²è¢«æŠ¢å®Œ' });
  }
  
  // 4. å‘æ”¾å¥–åŠ±
  try {
    await grantQuota(userId, event.reward_value);
    
    // 5. è®°å½•é¢†å–
    await db.coupon_claims.insert({
      event_id: event.id,
      user_id: userId,
      reward_value: event.reward_value,
      claimed_at: Date.now()
    });
    
    // 6. æ›´æ–°æ•°æ®åº“è®¡æ•°ï¼ˆå¼‚æ­¥ï¼Œä¸å½±å“å“åº”é€Ÿåº¦ï¼‰
    db.coupon_events.update(
      { id: event.id },
      { $inc: { claimed_count: 1 } }
    );
    
    res.json({ 
      success: true, 
      message: `æ­å–œï¼å·²è·å¾— ${event.reward_value} æ¬¡é¢åº¦`,
      rewardValue: event.reward_value
    });
  } catch (error) {
    // å‡ºé”™å›é€€
    await redis.decr(key);
    res.json({ success: false, message: 'é¢†å–å¤±è´¥ï¼Œè¯·é‡è¯•' });
  }
});

// è·å–æœ€è¿‘é¢†å–åŠ¨æ€ï¼ˆæ»šåŠ¨æ’­æŠ¥ï¼‰
app.get('/api/coupon/recent-claims', async (req, res) => {
  const { eventId } = req.query;
  
  const claims = await db.coupon_claims.find({
    event_id: eventId
  }, {
    sort: { claimed_at: -1 },
    limit: 10
  });
  
  // è„±æ•å¤„ç†
  const recentClaims = claims.map(c => ({
    nickname: '***' + c.user_id.substr(-3),
    timestamp: c.claimed_at
  }));
  
  res.json({ claims: recentClaims });
});
```

#### å‰ç«¯UIï¼ˆå°ç¨‹åºï¼‰

```typescript
// pages/coupon/coupon.ts

Page({
  data: {
    status: 'loading',      // loading/waiting/active/finished
    event: null,
    countdown: 0,           // å€’è®¡æ—¶ï¼ˆç§’ï¼‰
    recentClaims: [],       // æœ€è¿‘é¢†å–åŠ¨æ€
    claiming: false
  },
  
  onLoad() {
    this.fetchCurrentEvent();
    this.startPolling();
  },
  
  // è·å–å½“å‰æ´»åŠ¨
  async fetchCurrentEvent() {
    try {
      const res = await wx.request({
        url: 'https://your-api.com/api/coupon/current'
      });
      
      if (res.data.status === 'waiting') {
        // ç­‰å¾…ä¸‹ä¸€åœº
        this.setData({
          status: 'waiting',
          countdown: Math.floor((res.data.nextEvent.startAt - Date.now()) / 1000)
        });
        this.startCountdown();
      } else if (res.data.status === 'active') {
        // æ´»åŠ¨è¿›è¡Œä¸­
        this.setData({
          status: 'active',
          event: res.data.event,
          countdown: Math.floor((res.data.event.endAt - Date.now()) / 1000)
        });
        this.startCountdown();
        this.fetchRecentClaims(res.data.event.id);
      }
    } catch (error) {
      console.error('è·å–æ´»åŠ¨ä¿¡æ¯å¤±è´¥:', error);
    }
  },
  
  // å€’è®¡æ—¶
  startCountdown() {
    const timer = setInterval(() => {
      const countdown = this.data.countdown - 1;
      this.setData({ countdown });
      
      if (countdown <= 0) {
        clearInterval(timer);
        // åˆ·æ–°æ´»åŠ¨çŠ¶æ€
        this.fetchCurrentEvent();
      }
    }, 1000);
  },
  
  // è½®è¯¢ï¼ˆæ¯5ç§’åˆ·æ–°ä¸€æ¬¡ï¼‰
  startPolling() {
    setInterval(() => {
      if (this.data.status === 'active') {
        this.fetchCurrentEvent();
      }
    }, 5000);
  },
  
  // è·å–æœ€è¿‘é¢†å–åŠ¨æ€
  async fetchRecentClaims(eventId: number) {
    try {
      const res = await wx.request({
        url: 'https://your-api.com/api/coupon/recent-claims',
        data: { eventId }
      });
      
      this.setData({ recentClaims: res.data.claims });
    } catch (error) {
      console.error('è·å–åŠ¨æ€å¤±è´¥:', error);
    }
  },
  
  // æŠ¢åˆ¸
  async handleClaim() {
    if (this.data.claiming) return;
    
    this.setData({ claiming: true });
    
    try {
      const res = await wx.request({
        url: 'https://your-api.com/api/coupon/claim',
        method: 'POST',
        data: {
          userId: this.getDeviceId()
        }
      });
      
      if (res.data.success) {
        wx.showModal({
          title: 'ğŸ‰ é¢†å–æˆåŠŸï¼',
          content: res.data.message,
          showCancel: false,
          success: () => {
            // åˆ·æ–°é¡µé¢
            this.fetchCurrentEvent();
          }
        });
      } else {
        wx.showToast({
          title: res.data.message,
          icon: 'none',
          duration: 2000
        });
      }
    } catch (error) {
      wx.showToast({
        title: 'é¢†å–å¤±è´¥',
        icon: 'none'
      });
    } finally {
      this.setData({ claiming: false });
    }
  },
  
  getDeviceId(): string {
    let deviceId = wx.getStorageSync('device_uuid');
    if (!deviceId) {
      deviceId = 'device_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
      wx.setStorageSync('device_uuid', deviceId);
    }
    return deviceId;
  }
});
```

```xml
<!-- pages/coupon/coupon.wxml -->

<view class="container">
  <!-- ç­‰å¾…ä¸‹ä¸€åœº -->
  <view wx:if="{{status === 'waiting'}}" class="waiting-section">
    <view class="title">â° ä¸‹ä¸€åœºæ•´ç‚¹æŠ¢åˆ¸</view>
    <view class="countdown">{{countdown}}ç§’åå¼€å§‹</view>
    <view class="hint">è¯·è€å¿ƒç­‰å¾…...</view>
  </view>
  
  <!-- æ´»åŠ¨è¿›è¡Œä¸­ -->
  <view wx:if="{{status === 'active'}}" class="active-section">
    <view class="title">ğŸ”¥ æ•´ç‚¹æŠ¢åˆ¸è¿›è¡Œä¸­</view>
    
    <!-- è¿›åº¦æ¡ -->
    <view class="progress-section">
      <view class="progress-bar">
        <view class="progress-fill" style="width: {{event.claimedCount / event.totalQuota * 100}}%;"></view>
      </view>
      <view class="progress-text">
        <text>å·²æŠ¢ {{event.claimedCount}}</text>
        <text>å‰©ä½™ {{event.remaining}}</text>
      </view>
    </view>
    
    <!-- å¥–åŠ±ä¿¡æ¯ -->
    <view class="reward-info">
      <text class="reward-value">+{{event.rewardValue}}</text>
      <text class="reward-label">æ¬¡é¢åº¦</text>
    </view>
    
    <!-- æŠ¢åˆ¸æŒ‰é’® -->
    <button 
      bindtap="handleClaim" 
      disabled="{{claiming || event.remaining <= 0}}"
      class="claim-btn"
    >
      {{claiming ? 'é¢†å–ä¸­...' : (event.remaining > 0 ? 'ç«‹å³æŠ¢åˆ¸' : 'å·²æŠ¢å®Œ')}}
    </button>
    
    <!-- å€’è®¡æ—¶ -->
    <view class="countdown-hint">
      æ´»åŠ¨å‰©ä½™æ—¶é—´ï¼š{{Math.floor(countdown / 60)}}åˆ†{{countdown % 60}}ç§’
    </view>
    
    <!-- æœ€è¿‘é¢†å–åŠ¨æ€ -->
    <view class="recent-claims">
      <view class="recent-title">ğŸ‰ æœ€è¿‘é¢†å–</view>
      <view wx:for="{{recentClaims}}" wx:key="timestamp" class="claim-item">
        <text>ç”¨æˆ· {{item.nickname}} åˆšåˆšé¢†å–æˆåŠŸ</text>
      </view>
    </view>
  </view>
</view>
```

#### è®¢é˜…æ¶ˆæ¯æé†’

```typescript
// å®šæ—¶ä»»åŠ¡ï¼šæ´»åŠ¨å¼€å§‹å‰10åˆ†é’Ÿæ¨é€æé†’
cron.schedule('*/1 * * * *', async () => {
  const now = Date.now();
  const tenMinutesLater = now + 10 * 60 * 1000;
  
  // æŸ¥è¯¢å³å°†å¼€å§‹çš„æ´»åŠ¨
  const events = await db.coupon_events.find({
    status: 'pending',
    start_at: { $gt: now, $lte: tenMinutesLater },
    reminded: { $ne: true }
  });
  
  for (const event of events) {
    // æŸ¥è¯¢è®¢é˜…äº†æé†’çš„ç”¨æˆ·
    const subscribers = await db.subscribers.find({
      type: 'coupon_reminder',
      enabled: true
    });
    
    // æ‰¹é‡æ¨é€
    for (const sub of subscribers) {
      await sendSubscribeMessage({
        touser: sub.openid,
        template_id: 'coupon_reminder_template_id',
        page: 'pages/coupon/coupon',
        data: {
          thing1: { value: 'æ•´ç‚¹æŠ¢åˆ¸æ´»åŠ¨' },
          time2: { value: new Date(event.start_at).toLocaleString() },
          thing3: { value: `${event.total_quota}ä¸ªåé¢ï¼Œæ¯äºº+${event.reward_value}æ¬¡` }
        }
      });
    }
    
    // æ ‡è®°å·²æé†’
    await db.coupon_events.update(
      { id: event.id },
      { reminded: true }
    );
    
    console.log(`âœ… å·²æ¨é€ ${subscribers.length} æ¡æ´»åŠ¨æé†’`);
  }
});
```

---

### æ–¹æ¡ˆ3ï¼šå…‘æ¢ç ç³»ç»Ÿ

#### æ•°æ®åº“è®¾è®¡

```sql
-- å…‘æ¢ç è¡¨
CREATE TABLE redemption_codes (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  code VARCHAR(20) NOT NULL UNIQUE,    -- å…‘æ¢ç ï¼šMM-3K5J-2A9X
  source VARCHAR(50) NOT NULL,         -- æ¥æºï¼šgame_level_10, quiz_task_1
  type VARCHAR(20) NOT NULL,           -- ç±»å‹ï¼šquota/membership
  value INT NOT NULL,                  -- ä»·å€¼ï¼š20æ¬¡ æˆ– 7å¤©
  status VARCHAR(20) NOT NULL,         -- çŠ¶æ€ï¼šactive/used/expired
  generated_at BIGINT NOT NULL,        -- ç”Ÿæˆæ—¶é—´
  expire_at BIGINT NOT NULL,           -- è¿‡æœŸæ—¶é—´
  used_by VARCHAR(64),                 -- ä½¿ç”¨è€…
  used_at BIGINT,                      -- ä½¿ç”¨æ—¶é—´
  INDEX idx_code (code),
  INDEX idx_status (status)
);
```

#### ç”Ÿæˆå…‘æ¢ç 

```typescript
// ç”Ÿæˆå…‘æ¢ç 
function generateRedemptionCode(): string {
  const timestamp = Date.now().toString(36).toUpperCase();
  const random = Math.random().toString(36).substr(2, 4).toUpperCase();
  return `MM-${timestamp.substr(-4)}-${random}`;
}

// æ‰¹é‡ç”Ÿæˆå…‘æ¢ç ï¼ˆå¦‚æ¸¸æˆå…³å¡å¥–åŠ±ï¼‰
async function generateCodes(source: string, type: string, value: number, count: number, expireDays: number) {
  const codes = [];
  const expireAt = Date.now() + expireDays * 24 * 3600 * 1000;
  
  for (let i = 0; i < count; i++) {
    const code = generateRedemptionCode();
    codes.push({
      code,
      source,
      type,
      value,
      status: 'active',
      generated_at: Date.now(),
      expire_at: expireAt
    });
  }
  
  await db.redemption_codes.insertMany(codes);
  return codes;
}

// ç¤ºä¾‹ï¼šä¸ºæ¸¸æˆç¬¬10å…³ç”Ÿæˆ100ä¸ªå…‘æ¢ç 
await generateCodes('game_level_10', 'quota', 20, 100, 30); // 20æ¬¡é¢åº¦ï¼Œ30å¤©æœ‰æ•ˆ
```

#### å…‘æ¢ç API

```typescript
// å…‘æ¢
app.post('/api/redemption/redeem', async (req, res) => {
  const { code, userId } = req.body;
  
  // 1. æŸ¥è¯¢å…‘æ¢ç 
  const record = await db.redemption_codes.findOne({ code });
  
  if (!record) {
    return res.json({ success: false, message: 'å…‘æ¢ç ä¸å­˜åœ¨' });
  }
  
  if (record.status !== 'active') {
    return res.json({ success: false, message: 'å…‘æ¢ç å·²ä½¿ç”¨æˆ–å·²å¤±æ•ˆ' });
  }
  
  if (record.expire_at < Date.now()) {
    return res.json({ success: false, message: 'å…‘æ¢ç å·²è¿‡æœŸ' });
  }
  
  // 2. æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²å…‘æ¢è¿‡åŒæºå…‘æ¢ç ï¼ˆé˜²æ­¢åˆ·ï¼‰
  const alreadyRedeemed = await db.redemption_codes.findOne({
    source: record.source,
    used_by: userId
  });
  
  if (alreadyRedeemed) {
    return res.json({ success: false, message: 'æ‚¨å·²å…‘æ¢è¿‡è¯¥æ´»åŠ¨çš„å¥–åŠ±' });
  }
  
  // 3. å‘æ”¾å¥–åŠ±
  try {
    if (record.type === 'quota') {
      await grantQuota(userId, record.value);
    } else if (record.type === 'membership') {
      await grantMembership(userId, 'gift', record.value);
    }
    
    // 4. æ ‡è®°å…‘æ¢ç å·²ä½¿ç”¨
    await db.redemption_codes.update(
      { id: record.id },
      { 
        status: 'used', 
        used_by: userId, 
        used_at: Date.now() 
      }
    );
    
    res.json({ 
      success: true, 
      message: `å…‘æ¢æˆåŠŸï¼å·²è·å¾— ${record.value} ${record.type === 'quota' ? 'æ¬¡é¢åº¦' : 'å¤©ä¼šå‘˜'}`,
      type: record.type,
      value: record.value
    });
  } catch (error) {
    res.json({ success: false, message: 'å…‘æ¢å¤±è´¥ï¼Œè¯·é‡è¯•' });
  }
});

// éªŒè¯å…‘æ¢ç ï¼ˆä¸å®é™…å…‘æ¢ï¼Œä»…æŸ¥è¯¢ï¼‰
app.get('/api/redemption/validate', async (req, res) => {
  const { code } = req.query;
  
  const record = await db.redemption_codes.findOne({ code });
  
  if (!record) {
    return res.json({ valid: false, message: 'å…‘æ¢ç ä¸å­˜åœ¨' });
  }
  
  if (record.status !== 'active') {
    return res.json({ valid: false, message: 'å…‘æ¢ç å·²ä½¿ç”¨æˆ–å·²å¤±æ•ˆ' });
  }
  
  if (record.expire_at < Date.now()) {
    return res.json({ valid: false, message: 'å…‘æ¢ç å·²è¿‡æœŸ' });
  }
  
  res.json({
    valid: true,
    type: record.type,
    value: record.value,
    expireAt: record.expire_at
  });
});
```

#### æ¸¸æˆé›†æˆç¤ºä¾‹

```typescript
// å°æ¸¸æˆï¼šé€šå…³ç¬¬10å…³æ—¶å¼¹å‡ºå…‘æ¢ç 
// game.ts

function onLevelComplete(level: number) {
  if (level === 10) {
    // è¯·æ±‚æœåŠ¡ç«¯è·å–å…‘æ¢ç 
    wx.request({
      url: 'https://your-api.com/api/game/get-reward-code',
      method: 'POST',
      data: {
        userId: this.getUserId(),
        level: level
      },
      success: (res) => {
        if (res.data.success) {
          // æ˜¾ç¤ºå…‘æ¢ç å¼¹çª—
          wx.showModal({
            title: 'ğŸ‰ æ­å–œé€šå…³ï¼',
            content: `æ‚¨çš„å¥–åŠ±å…‘æ¢ç ï¼š\n${res.data.code}\n\nå¯åœ¨"å–µå–µç¾é¢œ"å°ç¨‹åºå…‘æ¢ ${res.data.value} æ¬¡é¢åº¦`,
            showCancel: false,
            confirmText: 'å¤åˆ¶å…‘æ¢ç ',
            success: (modalRes) => {
              if (modalRes.confirm) {
                wx.setClipboardData({
                  data: res.data.code,
                  success: () => {
                    wx.showToast({
                      title: 'å·²å¤åˆ¶ï¼Œå¿«å»å…‘æ¢å§ï¼',
                      icon: 'success'
                    });
                  }
                });
              }
            }
          });
        }
      }
    });
  }
}

// æœåŠ¡ç«¯ï¼šä¸ºé€šå…³ç©å®¶åˆ†é…å…‘æ¢ç 
app.post('/api/game/get-reward-code', async (req, res) => {
  const { userId, level } = req.body;
  
  // 1. éªŒè¯ç”¨æˆ·ç¡®å®é€šå…³äº†ï¼ˆé˜²æ­¢ä½œå¼Šï¼‰
  const userLevel = await db.game_progress.findOne({ user_id: userId });
  if (!userLevel || userLevel.max_level < level) {
    return res.json({ success: false, message: 'éªŒè¯å¤±è´¥' });
  }
  
  // 2. æ£€æŸ¥æ˜¯å¦å·²é¢†å–è¿‡è¯¥å…³å¡å¥–åŠ±
  const alreadyRewarded = await db.redemption_codes.findOne({
    source: `game_level_${level}`,
    generated_for: userId
  });
  
  if (alreadyRewarded) {
    return res.json({ 
      success: true, 
      code: alreadyRewarded.code,
      value: alreadyRewarded.value
    });
  }
  
  // 3. ç”Ÿæˆä¸“å±å…‘æ¢ç 
  const code = generateRedemptionCode();
  const value = level === 10 ? 20 : (level === 20 ? 50 : 10);
  
  await db.redemption_codes.insert({
    code,
    source: `game_level_${level}`,
    type: 'quota',
    value,
    status: 'active',
    generated_at: Date.now(),
    expire_at: Date.now() + 30 * 24 * 3600 * 1000, // 30å¤©æœ‰æ•ˆ
    generated_for: userId
  });
  
  res.json({ 
    success: true, 
    code,
    value
  });
});
```

---

### æ–¹æ¡ˆ4ï¼šUnionID æœºåˆ¶ï¼ˆæ‰“é€šå¤šä¸ªå°ç¨‹åºï¼‰

#### åŸç†

```
åŒä¸€ä¸ªå¾®ä¿¡å¼€æ”¾å¹³å°è´¦å·ä¸‹çš„å¤šä¸ªå°ç¨‹åºï¼š
- å°ç¨‹åº1ï¼šopenid_1ï¼ˆå”¯ä¸€ï¼‰
- å°ç¨‹åº2ï¼šopenid_2ï¼ˆå”¯ä¸€ï¼‰
- å…¬ä¼—å·ï¼šopenid_3ï¼ˆå”¯ä¸€ï¼‰

ä½†å®ƒä»¬éƒ½æœ‰åŒä¸€ä¸ª UnionIDï¼ˆè·¨åº”ç”¨å”¯ä¸€æ ‡è¯†ï¼‰

é€šè¿‡ UnionID è¯†åˆ«åŒä¸€ç”¨æˆ· â†’ ä¼šå‘˜ä½“ç³»æ‰“é€š
```

#### æ•°æ®åº“è®¾è®¡

```sql
-- ç”¨æˆ·è¡¨ï¼ˆè·¨åº”ç”¨ï¼‰
CREATE TABLE users (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  unionid VARCHAR(64) NOT NULL UNIQUE, -- è·¨åº”ç”¨å”¯ä¸€æ ‡è¯†
  nickname VARCHAR(100),
  avatar_url VARCHAR(500),
  created_at BIGINT NOT NULL,
  INDEX idx_unionid (unionid)
);

-- ç”¨æˆ·èº«ä»½è¡¨ï¼ˆå¤šä¸ªå°ç¨‹åºçš„ openidï¼‰
CREATE TABLE user_identities (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id BIGINT NOT NULL,
  app_id VARCHAR(64) NOT NULL,         -- å°ç¨‹åº/å…¬ä¼—å· appid
  openid VARCHAR(64) NOT NULL,         -- è¯¥åº”ç”¨ä¸‹çš„ openid
  created_at BIGINT NOT NULL,
  UNIQUE KEY uk_app_openid (app_id, openid),
  INDEX idx_user_id (user_id)
);

-- ä¼šå‘˜è¡¨ï¼ˆåŸºäº user_idï¼Œè·¨åº”ç”¨é€šç”¨ï¼‰
CREATE TABLE memberships (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id BIGINT NOT NULL UNIQUE,
  type VARCHAR(20) NOT NULL,           -- paid/gift
  expire_at BIGINT NOT NULL,
  created_at BIGINT NOT NULL,
  INDEX idx_user_id (user_id),
  INDEX idx_expire_at (expire_at)
);
```

#### ç”¨æˆ·ç™»å½•æµç¨‹

```typescript
// å°ç¨‹åºç™»å½•
app.post('/api/user/login', async (req, res) => {
  const { code, appId } = req.body; // code æ˜¯ wx.login() è·å–çš„
  
  // 1. å‘å¾®ä¿¡æœåŠ¡å™¨æ¢å– openid å’Œ unionid
  const wxRes = await axios.get('https://api.weixin.qq.com/sns/jscode2session', {
    params: {
      appid: appId,
      secret: 'your-app-secret',
      js_code: code,
      grant_type: 'authorization_code'
    }
  });
  
  const { openid, unionid } = wxRes.data;
  
  if (!unionid) {
    // å¦‚æœæ²¡æœ‰ unionidï¼Œè¯´æ˜ç”¨æˆ·æœªç»‘å®šåˆ°å¼€æ”¾å¹³å°
    // éœ€è¦å¼•å¯¼ç”¨æˆ·å…³æ³¨å…¬ä¼—å·æˆ–æˆæƒ
    return res.json({ success: false, message: 'è¯·å…ˆæˆæƒè·å–å®Œæ•´ä¿¡æ¯' });
  }
  
  // 2. æŸ¥è¯¢æˆ–åˆ›å»ºç”¨æˆ·
  let user = await db.users.findOne({ unionid });
  
  if (!user) {
    // æ–°ç”¨æˆ·
    user = await db.users.insert({
      unionid,
      created_at: Date.now()
    });
  }
  
  // 3. ç»‘å®šè¯¥åº”ç”¨çš„ openid
  const identity = await db.user_identities.findOne({
    user_id: user.id,
    app_id: appId
  });
  
  if (!identity) {
    await db.user_identities.insert({
      user_id: user.id,
      app_id: appId,
      openid,
      created_at: Date.now()
    });
  }
  
  // 4. æŸ¥è¯¢ä¼šå‘˜çŠ¶æ€
  const membership = await db.memberships.findOne({ user_id: user.id });
  const isMember = membership && membership.expire_at > Date.now();
  
  // 5. ç”Ÿæˆ token
  const token = jwt.sign({ userId: user.id, unionid }, 'your-secret', { expiresIn: '7d' });
  
  res.json({
    success: true,
    token,
    user: {
      id: user.id,
      unionid: user.unionid,
      isMember,
      memberExpireAt: membership?.expire_at
    }
  });
});

// ä½¿ç”¨ç¤ºä¾‹ï¼š
// ç”¨æˆ·åœ¨"å–µå–µç¾é¢œ"è´­ä¹°ä¼šå‘˜ â†’ user_id: 123
// ç”¨æˆ·æ‰“å¼€"PDFè½¬JPG"å°ç¨‹åº â†’ ç™»å½•åè¯†åˆ«ä¸ºåŒä¸€ä¸ª user_id: 123 â†’ è‡ªåŠ¨äº«æœ‰ä¼šå‘˜æƒç›Š
```

---

## ğŸ“… åˆ†é˜¶æ®µå®æ–½è®¡åˆ’

### ğŸ¯ é˜¶æ®µ0ï¼šå½“å‰ï¼ˆ2025-10-31ï¼‰

**ç›®æ ‡ï¼š** éªŒè¯äº§å“ä»·å€¼

**ä»»åŠ¡ï¼š**
- âœ… å–µå–µç¾é¢œå·²ä¸Šçº¿
- âœ… åŸºç¡€åˆ†äº«æœºåˆ¶å·²å®ç°ï¼ˆåˆ†äº« +10 æ¬¡ï¼‰
- â³ æ”¶é›†ç”¨æˆ·åé¦ˆ
- â³ ä¼˜åŒ–äº§å“ä½“éªŒ

**é‡Œç¨‹ç¢‘ï¼š** è·å¾— 100 ä¸ªçœŸå®ç”¨æˆ·

---

### ğŸ¯ é˜¶æ®µ1ï¼šå…¬ä¼—å·åŸºç¡€å»ºè®¾ï¼ˆé¢„è®¡1-2å‘¨ï¼‰

**ç›®æ ‡ï¼š** æ­å»ºæµé‡ä¸­å¿ƒ

#### Week 1ï¼šå…¬ä¼—å·æ³¨å†Œä¸é…ç½®

**ä»»åŠ¡ï¼š**
1. æ³¨å†Œå¾®ä¿¡å…¬ä¼—å·ï¼ˆæœåŠ¡å·ï¼Œæ”¯æŒè‡ªå®šä¹‰èœå•å’Œæ¨¡æ¿æ¶ˆæ¯ï¼‰
2. é…ç½®æœåŠ¡å™¨ï¼ˆæ¥æ”¶å¾®ä¿¡äº‹ä»¶æ¨é€ï¼‰
3. ç”³è¯·"ç”Ÿæˆå¸¦å‚æ•°äºŒç»´ç "æƒé™
4. è®¾è®¡å…¬ä¼—å·èœå•ç»“æ„ï¼š
   ```
   ã€æˆ‘çš„å·¥å…·ã€‘
   â”œâ”€ å–µå–µç¾é¢œ
   â”œâ”€ PDFè½¬JPGï¼ˆå³å°†ä¸Šçº¿ï¼‰
   â””â”€ æ›´å¤šå·¥å…·...
   
   ã€é¢†å–é¢åº¦ã€‘
   â”œâ”€ å…³æ³¨å¥–åŠ±ï¼ˆ50æ¬¡ï¼‰
   â”œâ”€ æ•´ç‚¹æŠ¢åˆ¸
   â””â”€ å…‘æ¢ç 
   
   ã€æˆ‘çš„è´¦æˆ·ã€‘
   â”œâ”€ ä¼šå‘˜ä¸­å¿ƒ
   â””â”€ è”ç³»å®¢æœ
   ```

**æŠ€æœ¯è¦ç‚¹ï¼š**
- æœåŠ¡ç«¯éœ€è¦å¤„ç†å¾®ä¿¡äº‹ä»¶ï¼ˆsubscribe/unsubscribe/CLICK/messageï¼‰
- éªŒè¯å¾®ä¿¡æœåŠ¡å™¨ç­¾åï¼ˆsignatureéªŒè¯ï¼‰
- é…ç½®"ä¸šåŠ¡åŸŸå"å’Œ"JSæ¥å£å®‰å…¨åŸŸå"

**å®Œæˆæ ‡å‡†ï¼š**
- å…¬ä¼—å·å¯ä»¥æ¥æ”¶ç”¨æˆ·å…³æ³¨/å–å…³äº‹ä»¶
- è‡ªå®šä¹‰èœå•å¯ä»¥è·³è½¬å°ç¨‹åº
- å¯ä»¥å‘ç”¨æˆ·å‘é€æ–‡æœ¬/å›¾æ–‡æ¶ˆæ¯

---

#### Week 2ï¼šå…³æ³¨å¥–åŠ±åŠŸèƒ½

**ä»»åŠ¡ï¼š**
1. å®ç°"éªŒè¯ç æœºåˆ¶"æ–¹æ¡ˆ
2. åˆ›å»ºæ•°æ®åº“è¡¨ï¼ˆverification_codes, follow_historyï¼‰
3. å¼€å‘æœåŠ¡ç«¯APIï¼ˆç”ŸæˆéªŒè¯ç ã€éªŒè¯éªŒè¯ç ã€å¤„ç†å…³æ³¨äº‹ä»¶ï¼‰
4. åœ¨å°ç¨‹åºå†…æ·»åŠ "å…³æ³¨é¢†50æ¬¡"å…¥å£
5. æµ‹è¯•å®Œæ•´æµç¨‹

**æŠ€æœ¯è¦ç‚¹ï¼š**
- éªŒè¯ç 5åˆ†é’Ÿæœ‰æ•ˆæœŸ
- åä½œå¼Šæœºåˆ¶ï¼ˆ7å¤©å†…å…³æ³¨-å–å…³è¶…è¿‡3æ¬¡ä¸å‘æ”¾å¥–åŠ±ï¼‰
- æ¯ä¸ªç”¨æˆ·åªèƒ½é¢†å–1æ¬¡å…³æ³¨å¥–åŠ±

**å®Œæˆæ ‡å‡†ï¼š**
- ç”¨æˆ·å¯ä»¥é€šè¿‡éªŒè¯ç æœºåˆ¶é¢†å–50æ¬¡é¢åº¦
- å–å…³åæ ‡è®°è®°å½•ï¼Œå†æ¬¡å…³æ³¨ä¸é‡å¤å‘æ”¾
- å¼‚å¸¸è¡Œä¸ºæ£€æµ‹æ­£å¸¸å·¥ä½œ

---

### ğŸ¯ é˜¶æ®µ2ï¼šæ•´ç‚¹æŠ¢åˆ¸ç³»ç»Ÿï¼ˆé¢„è®¡1å‘¨ï¼‰

**ç›®æ ‡ï¼š** å¢åŠ ç”¨æˆ·æ´»è·ƒåº¦å’Œç²˜æ€§

**ä»»åŠ¡ï¼š**
1. åˆ›å»ºæ•°æ®åº“è¡¨ï¼ˆcoupon_events, coupon_claimsï¼‰
2. å¼€å‘å®šæ—¶ä»»åŠ¡ï¼ˆæ¯å¤©åˆ›å»ºæ´»åŠ¨ã€æ´»åŠ¨çŠ¶æ€ç®¡ç†ï¼‰
3. å¼€å‘æœåŠ¡ç«¯APIï¼ˆè·å–æ´»åŠ¨ä¿¡æ¯ã€æŠ¢åˆ¸ã€æœ€è¿‘é¢†å–åŠ¨æ€ï¼‰
4. ä½¿ç”¨Rediså®ç°åŸå­æ“ä½œï¼ˆé˜²æ­¢è¶…å‘ï¼‰
5. åœ¨å°ç¨‹åºå†…åˆ›å»º"æ•´ç‚¹æŠ¢åˆ¸"é¡µé¢
6. å®ç°è®¢é˜…æ¶ˆæ¯æé†’ï¼ˆæå‰10åˆ†é’Ÿï¼‰

**æŠ€æœ¯è¦ç‚¹ï¼š**
- Redis INCR åŸå­æ“ä½œä¿è¯ä¸è¶…å‘
- å®šæ—¶ä»»åŠ¡å‡†æ—¶æ¿€æ´»æ´»åŠ¨
- å‰ç«¯å®æ—¶æ›´æ–°å‰©ä½™åé¢
- ç¤¾äº¤è¯æ˜ï¼ˆ"å·²æœ‰23äººé¢†å–"ï¼‰

**å®Œæˆæ ‡å‡†ï¼š**
- æ¯å¤©12:00å’Œ18:00è‡ªåŠ¨å¼€å§‹æŠ¢åˆ¸
- 100ä¸ªåé¢ä¸ä¼šè¶…å‘
- ç”¨æˆ·å¯ä»¥çœ‹åˆ°å®æ—¶è¿›åº¦å’ŒåŠ¨æ€
- è®¢é˜…æé†’å¯ä»¥æ­£å¸¸æ¨é€

---

### ğŸ¯ é˜¶æ®µ3ï¼šå…‘æ¢ç ç³»ç»Ÿï¼ˆé¢„è®¡1å‘¨ï¼‰

**ç›®æ ‡ï¼š** ä¸ºåç»­æ¸¸æˆ/ç­”é¢˜å°ç¨‹åºåšå‡†å¤‡

**ä»»åŠ¡ï¼š**
1. åˆ›å»ºæ•°æ®åº“è¡¨ï¼ˆredemption_codesï¼‰
2. å¼€å‘å…‘æ¢ç ç”Ÿæˆé€»è¾‘
3. å¼€å‘æœåŠ¡ç«¯APIï¼ˆå…‘æ¢ã€éªŒè¯ï¼‰
4. åœ¨å°ç¨‹åºå†…æ·»åŠ "å…‘æ¢ç "å…¥å£
5. åœ¨å…¬ä¼—å·å†…æ·»åŠ "å…‘æ¢ç "èœå•ï¼ˆè·³è½¬å°ç¨‹åºï¼‰

**æŠ€æœ¯è¦ç‚¹ï¼š**
- å…‘æ¢ç æ ¼å¼ï¼šMM-3K5J-2A9Xï¼ˆæ˜“è¯†åˆ«ã€ä¸æ˜“è¾“é”™ï¼‰
- é˜²åˆ·æœºåˆ¶ï¼ˆåŒæºå…‘æ¢ç æ¯äººåªèƒ½å…‘æ¢1æ¬¡ï¼‰
- å…‘æ¢ç æœ‰æ•ˆæœŸç®¡ç†

**å®Œæˆæ ‡å‡†ï¼š**
- å¯ä»¥æ‰¹é‡ç”Ÿæˆå…‘æ¢ç 
- ç”¨æˆ·å¯ä»¥åœ¨å°ç¨‹åºå†…è¾“å…¥å…‘æ¢ç é¢†å–å¥–åŠ±
- åŒä¸€ä¸ªå…‘æ¢ç åªèƒ½ä½¿ç”¨1æ¬¡
- åŒä¸€æ¥æºçš„å¥–åŠ±æ¯äººåªèƒ½é¢†å–1æ¬¡

---

### ğŸ¯ é˜¶æ®µ4ï¼šç¬¬äºŒä¸ªå°ç¨‹åºï¼ˆé¢„è®¡2-3å‘¨ï¼‰

**ç›®æ ‡ï¼š** éªŒè¯çŸ©é˜µæ¨¡å¼

**ä»»åŠ¡ï¼š**
1. é€‰æ‹©å¼€å‘"PDFè½¬JPG"æˆ–å…¶ä»–é«˜é¢‘å·¥å…·
2. å¼€å‘å°ç¨‹åºï¼ˆå¤ç”¨å–µå–µç¾é¢œçš„æ¡†æ¶ï¼‰
3. æ¥å…¥UnionIDæœºåˆ¶
4. æ‰“é€šä¼šå‘˜ä½“ç³»
5. åœ¨å…¬ä¼—å·æ·»åŠ å…¥å£

**æŠ€æœ¯è¦ç‚¹ï¼š**
- ç»Ÿä¸€ç”¨æˆ·ç™»å½•é€»è¾‘ï¼ˆåŸºäºUnionIDï¼‰
- ä¼šå‘˜æƒç›Šè·¨åº”ç”¨ç”Ÿæ•ˆ
- é¢åº¦ç³»ç»Ÿè·¨åº”ç”¨å…±äº«ï¼ˆå¯é€‰ï¼‰

**å®Œæˆæ ‡å‡†ï¼š**
- æ–°å°ç¨‹åºå¯ä»¥ç‹¬ç«‹è¿è¡Œ
- ç”¨æˆ·åœ¨ä»»ä¸€å°ç¨‹åºè´­ä¹°ä¼šå‘˜ï¼Œåœ¨å¦ä¸€ä¸ªå°ç¨‹åºä¹Ÿç”Ÿæ•ˆ
- å…¬ä¼—å·èœå•å¯ä»¥è·³è½¬åˆ°ä¸¤ä¸ªå°ç¨‹åº

---

### ğŸ¯ é˜¶æ®µ5ï¼šå°æ¸¸æˆå¼€å‘ï¼ˆé¢„è®¡1-2ä¸ªæœˆï¼‰

**ç›®æ ‡ï¼š** å¢åŠ è¶£å‘³æ€§å’Œå¹¿å‘Šå˜ç°

**ä»»åŠ¡ï¼š**
1. è®¾è®¡å°æ¸¸æˆç©æ³•ï¼ˆå¦‚æ¶ˆé™¤ç±»ã€è·‘é…·ç±»ï¼‰
2. é›†æˆå¾®ä¿¡å°æ¸¸æˆå¹¿å‘Šï¼ˆæ¿€åŠ±è§†é¢‘å¹¿å‘Šï¼‰
3. é€šå…³å¥–åŠ±å…‘æ¢ç 
4. åœ¨å…¬ä¼—å·æ·»åŠ å…¥å£

**æŠ€æœ¯è¦ç‚¹ï¼š**
- å°æ¸¸æˆæ¡†æ¶ï¼ˆCocos Creator / LayaAir / åŸç”ŸCanvasï¼‰
- æ¿€åŠ±è§†é¢‘å¹¿å‘Šé›†æˆ
- é˜²ä½œå¼Šæœºåˆ¶ï¼ˆæœåŠ¡ç«¯éªŒè¯é€šå…³ï¼‰

**å®Œæˆæ ‡å‡†ï¼š**
- å°æ¸¸æˆå¯ä»¥æ­£å¸¸è¿è¡Œ
- é€šå…³åå¼¹å‡ºå…‘æ¢ç 
- å¹¿å‘Šæ’­æ”¾æ­£å¸¸ï¼Œæœ‰æ”¶ç›Š
- å…‘æ¢ç å¯ä»¥åœ¨å–µå–µç¾é¢œå°ç¨‹åºå…‘æ¢

---

### ğŸ¯ é˜¶æ®µ6ï¼šç­”é¢˜å°ç¨‹åºï¼ˆé¢„è®¡2-3å‘¨ï¼‰

**ç›®æ ‡ï¼š** çŸ¥è¯†ç±»å†…å®¹ï¼Œå¢åŠ ç”¨æˆ·åœç•™æ—¶é—´

**ä»»åŠ¡ï¼š**
1. è®¾è®¡é¢˜åº“ï¼ˆçŸ¥è¯†é—®ç­”ã€è¶£å‘³æµ‹è¯•ï¼‰
2. å¼€å‘ç­”é¢˜å°ç¨‹åº
3. é›†æˆå¹¿å‘Šï¼ˆæ’å±å¹¿å‘Šã€æ¿€åŠ±è§†é¢‘å¹¿å‘Šï¼‰
4. ç­”é¢˜ä»»åŠ¡å¥–åŠ±å…‘æ¢ç 
5. åœ¨å…¬ä¼—å·æ·»åŠ å…¥å£

**å®Œæˆæ ‡å‡†ï¼š**
- ç­”é¢˜å°ç¨‹åºå¯ä»¥æ­£å¸¸è¿è¡Œ
- å®Œæˆä»»åŠ¡åè·å¾—å…‘æ¢ç 
- å¹¿å‘Šæ’­æ”¾æ­£å¸¸

---

## âš ï¸ é£é™©ä¸æ³¨æ„äº‹é¡¹

### 1. åˆè§„é£é™©

**å¾®ä¿¡å¹³å°è§„åˆ™ï¼š**
- âŒ **è¯±å¯¼åˆ†äº«**ï¼šä¸¥æ ¼ç¦æ­¢
  - "åˆ†äº«åˆ°æœ‹å‹åœˆæ‰èƒ½ç»§ç»­ä½¿ç”¨"
  - "åˆ†äº«ç»™5ä¸ªå¥½å‹æ‰èƒ½è§£é”"
  - "åˆ†äº«åæ˜¾ç¤ºç­”æ¡ˆ"
  
- âŒ **è™šå‡å®£ä¼ **ï¼šå¯èƒ½è¢«æŠ•è¯‰
  - "å·²æœ‰1000äººé¢†å–"ï¼ˆå®é™…åªæœ‰10äººï¼‰
  - "é™æ—¶å…è´¹"ï¼ˆå®é™…ä¸€ç›´å…è´¹ï¼‰
  
- âŒ **è¿‡åº¦è¥é”€**ï¼šå¯èƒ½è¢«é™æµ
  - é¢‘ç¹æ¨é€æ¶ˆæ¯
  - å¼ºåˆ¶å…³æ³¨å…¬ä¼—å·
  
**è§£å†³æ–¹æ¡ˆï¼š**
- âœ… æä¾›å¤šç§è·å–é¢åº¦æ–¹å¼ï¼ˆåˆ†äº«/å¹¿å‘Š/ä»»åŠ¡ï¼‰
- âœ… ä½¿ç”¨çœŸå®æ•°æ®æˆ–åˆç†ä¼°ç®—
- âœ… è®¢é˜…æ¶ˆæ¯ç”±ç”¨æˆ·ä¸»åŠ¨æˆæƒ
- âœ… å…³æ³¨å…¬ä¼—å·æ˜¯å¥–åŠ±è€Œä¸æ˜¯å¼ºåˆ¶

---

### 2. æŠ€æœ¯é£é™©

**é«˜å¹¶å‘é—®é¢˜ï¼š**
- **æ•´ç‚¹æŠ¢åˆ¸**å¯èƒ½ç¬é—´æ¶Œå…¥å¤§é‡è¯·æ±‚
- **è§£å†³æ–¹æ¡ˆ**ï¼š
  - ä½¿ç”¨RedisåŸå­æ“ä½œï¼ˆINCR/DECRï¼‰
  - æ¥å£é™æµï¼ˆæ¯ä¸ªç”¨æˆ·5ç§’å†…åªèƒ½è¯·æ±‚1æ¬¡ï¼‰
  - CDNåŠ é€Ÿé™æ€èµ„æº

**æ•°æ®ä¸€è‡´æ€§ï¼š**
- UnionIDç»‘å®šå¯èƒ½å¤±è´¥
- **è§£å†³æ–¹æ¡ˆ**ï¼š
  - ä½¿ç”¨äº‹åŠ¡ä¿è¯æ•°æ®ä¸€è‡´æ€§
  - å®šæœŸæ ¡éªŒæ•°æ®
  - æ—¥å¿—è®°å½•æ‰€æœ‰å…³é”®æ“ä½œ

**ç”¨æˆ·ä½“éªŒï¼š**
- è·¨åº”ç”¨è·³è½¬å¯èƒ½ä¸­æ–­æµç¨‹
- **è§£å†³æ–¹æ¡ˆ**ï¼š
  - ä¼˜åŒ–è·³è½¬è·¯å¾„ï¼ˆå…¬ä¼—å·èœå•ç›´æ¥è·³è½¬ï¼‰
  - å°ç¨‹åºå†…åµŒH5é¡µé¢ï¼ˆå¦‚å…‘æ¢ç é¡µé¢ï¼‰
  - æä¾›æ¸…æ™°çš„å¼•å¯¼æ–‡æ¡ˆ

---

### 3. è¿è¥é£é™©

**ç”¨æˆ·ç•™å­˜ï¼š**
- å¦‚æœäº§å“ä¸å¤Ÿåˆšéœ€ï¼Œç”¨æˆ·å¯èƒ½é¢†å®Œé¢åº¦å°±èµ°
- **è§£å†³æ–¹æ¡ˆ**ï¼š
  - åšå¥½æ ¸å¿ƒäº§å“ï¼ˆå¦‚å–µå–µç¾é¢œï¼‰
  - å®šæœŸæ¨å‡ºæ–°åŠŸèƒ½
  - å…¬ä¼—å·æ¨é€æœ‰ä»·å€¼çš„å†…å®¹ï¼ˆä¸åªæ˜¯è¥é”€ï¼‰

**ç¾Šæ¯›å…šï¼š**
- å¯èƒ½æœ‰äººæ‰¹é‡æ³¨å†Œè´¦å·åˆ·å¥–åŠ±
- **è§£å†³æ–¹æ¡ˆ**ï¼š
  - è®¾å¤‡æŒ‡çº¹è¯†åˆ«
  - è¡Œä¸ºåˆ†æï¼ˆçŸ­æ—¶é—´å¤§é‡æ“ä½œ = å¼‚å¸¸ï¼‰
  - åŒIPé™åˆ¶
  - æ‰‹æœºå·éªŒè¯ï¼ˆé«˜ä»·å€¼å¥–åŠ±ï¼‰

**æˆæœ¬æ§åˆ¶ï¼š**
- å¹¿å‘Šæ”¶ç›Šå¯èƒ½ä¸è¶³ä»¥è¦†ç›–æœåŠ¡å™¨æˆæœ¬
- **è§£å†³æ–¹æ¡ˆ**ï¼š
  - åˆæœŸæ§åˆ¶è§„æ¨¡ï¼ˆå¦‚æ•´ç‚¹æŠ¢åˆ¸æ¯å¤©åªæ”¾200ä¸ªåé¢ï¼‰
  - ç›‘æ§æˆæœ¬å’Œæ”¶ç›Š
  - å¿…è¦æ—¶å¼•å…¥ä»˜è´¹ä¼šå‘˜

---

### 4. å¼€å‘æˆæœ¬

**é¢„ä¼°å·¥ä½œé‡ï¼š**
- é˜¶æ®µ1-3ï¼ˆå…¬ä¼—å·+æŠ¢åˆ¸+å…‘æ¢ç ï¼‰ï¼š**3-4å‘¨**
- é˜¶æ®µ4ï¼ˆç¬¬äºŒä¸ªå°ç¨‹åºï¼‰ï¼š**2-3å‘¨**
- é˜¶æ®µ5ï¼ˆå°æ¸¸æˆï¼‰ï¼š**1-2ä¸ªæœˆ**ï¼ˆå–å†³äºå¤æ‚åº¦ï¼‰
- é˜¶æ®µ6ï¼ˆç­”é¢˜å°ç¨‹åºï¼‰ï¼š**2-3å‘¨**

**æ€»è®¡ï¼š** çº¦ **3-4ä¸ªæœˆ** å¯ä»¥æ­å»ºèµ·å®Œæ•´çŸ©é˜µ

**é™ä½æˆæœ¬çš„æ–¹æ³•ï¼š**
- å¤ç”¨ä»£ç ï¼ˆå°ç¨‹åºæ¡†æ¶ã€ç™»å½•é€»è¾‘ã€ä¼šå‘˜ç³»ç»Ÿï¼‰
- ä½¿ç”¨å¼€æºç»„ä»¶ï¼ˆå¦‚ç­”é¢˜å°ç¨‹åºå¯ä»¥æ‰¾å¼€æºæ¨¡æ¿ï¼‰
- ä¼˜å…ˆå¼€å‘MVPï¼Œé€æ­¥è¿­ä»£

---

## ğŸš€ ç«‹å³å¯ä»¥å¼€å§‹çš„å·¥ä½œ

### 1. æ³¨å†Œå…¬ä¼—å·
- å‰å¾€ [å¾®ä¿¡å…¬ä¼—å¹³å°](https://mp.weixin.qq.com/)
- é€‰æ‹©"æœåŠ¡å·"ï¼ˆæ”¯æŒæ›´å¤šåŠŸèƒ½ï¼‰
- å‡†å¤‡èµ„æ–™ï¼šè¥ä¸šæ‰§ç…§ã€èº«ä»½è¯ã€å¯¹å…¬è´¦æˆ·ï¼ˆå¦‚æœæ˜¯ä¼ä¸šï¼‰

### 2. ç”³è¯·å¾®ä¿¡å¼€æ”¾å¹³å°è´¦å·
- å‰å¾€ [å¾®ä¿¡å¼€æ”¾å¹³å°](https://open.weixin.qq.com/)
- ç»‘å®šå…¬ä¼—å·å’Œå°ç¨‹åº
- è·å–UnionIDèƒ½åŠ›

### 3. è®¾è®¡æ•°æ®åº“è¡¨ç»“æ„
- æŒ‰ç…§ä¸Šé¢çš„æ–¹æ¡ˆåˆ›å»ºè¡¨
- å¯ä»¥å…ˆåœ¨æœ¬åœ°MySQLæµ‹è¯•

### 4. å¼€å‘å…¬ä¼—å·åå°
- æ­å»ºNode.jsæœåŠ¡å™¨ï¼ˆæˆ–å…¶ä»–åç«¯ï¼‰
- æ¥æ”¶å¾®ä¿¡äº‹ä»¶æ¨é€
- å¤„ç†ç”¨æˆ·å…³æ³¨/å–å…³/æ¶ˆæ¯

### 5. åœ¨å–µå–µç¾é¢œæ·»åŠ "å…³æ³¨é¢†50æ¬¡"å…¥å£
- åˆ›å»ºæ–°é¡µé¢ `pages/follow-reward/follow-reward`
- å®ç°éªŒè¯ç æœºåˆ¶

---

## ğŸ“ å¿«é€Ÿå‚è€ƒ

### å…³é”®APIæ–‡æ¡£

- [å¾®ä¿¡å…¬ä¼—å¹³å°å¼€å‘æ–‡æ¡£](https://developers.weixin.qq.com/doc/offiaccount/Getting_Started/Overview.html)
- [å¾®ä¿¡å°ç¨‹åºå¼€å‘æ–‡æ¡£](https://developers.weixin.qq.com/miniprogram/dev/framework/)
- [UnionIDæœºåˆ¶è¯´æ˜](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/union-id.html)
- [è®¢é˜…æ¶ˆæ¯](https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/subscribe-message/subscribeMessage.send.html)

### æŠ€æœ¯æ ˆå»ºè®®

**åç«¯ï¼š**
- Node.js + Expressï¼ˆè½»é‡çº§ï¼Œé€‚åˆå¿«é€Ÿå¼€å‘ï¼‰
- MySQLï¼ˆå…³ç³»å‹æ•°æ®åº“ï¼Œç»“æ„åŒ–æ•°æ®ï¼‰
- Redisï¼ˆç¼“å­˜ã€åŸå­æ“ä½œã€ä¼šè¯ç®¡ç†ï¼‰

**å‰ç«¯ï¼š**
- å°ç¨‹åºåŸç”Ÿæ¡†æ¶ï¼ˆå®˜æ–¹æ”¯æŒå¥½ï¼Œæ€§èƒ½ä¼˜ï¼‰
- æˆ– Taro / uni-appï¼ˆè·¨ç«¯å¼€å‘ï¼Œä¸€å¥—ä»£ç å¤šç«¯è¿è¡Œï¼‰

**éƒ¨ç½²ï¼š**
- è…¾è®¯äº‘ / é˜¿é‡Œäº‘ï¼ˆå°ç¨‹åºå’Œå…¬ä¼—å·åœ¨å›½å†…ï¼Œé€‰å›½å†…æœåŠ¡å™¨ï¼‰
- Docker + PM2ï¼ˆå®¹å™¨åŒ–éƒ¨ç½²ï¼Œè‡ªåŠ¨é‡å¯ï¼‰
- Nginxï¼ˆåå‘ä»£ç†ï¼ŒHTTPSè¯ä¹¦ï¼‰

---

## ğŸ’¬ æœ€åå»ºè®®

1. **å…ˆåšå¥½ä¸€ä¸ªäº§å“**
   - å–µå–µç¾é¢œå…ˆç§¯ç´¯1000ä¸ªæ´»è·ƒç”¨æˆ·
   - éªŒè¯"åˆ†äº«æœºåˆ¶"æ˜¯å¦æœ‰æ•ˆ
   - æ”¶é›†ç”¨æˆ·ç”»åƒå’Œéœ€æ±‚

2. **å†æ‰©å±•çŸ©é˜µ**
   - åŸºäºç”¨æˆ·åé¦ˆï¼Œå†³å®šä¸‹ä¸€ä¸ªäº§å“æ–¹å‘
   - ä¼˜å…ˆåš"é«˜é¢‘åˆšéœ€"ï¼ˆå¦‚PDFè½¬JPGï¼‰

3. **å…¬ä¼—å·æ˜¯å…³é”®**
   - ä½œä¸ºæµé‡ä¸­å¿ƒå’Œç”¨æˆ·è§¦è¾¾æ¸ é“
   - å®šæœŸæ¨é€ä»·å€¼å†…å®¹ï¼ˆä¸åªæ˜¯å¹¿å‘Šï¼‰
   - å»ºç«‹ç”¨æˆ·ä¿¡ä»»

4. **åˆè§„ç¬¬ä¸€**
   - å¾®ä¿¡çš„è§„åˆ™å¾ˆä¸¥æ ¼
   - è¯±å¯¼åˆ†äº«ã€è™šå‡å®£ä¼ éƒ½å¯èƒ½å¯¼è‡´å°å·
   - å»ºè®®å…ˆå°è§„æ¨¡æµ‹è¯•ï¼Œè§‚å¯Ÿå¹³å°åé¦ˆ

5. **æ•°æ®é©±åŠ¨**
   - è®°å½•æ‰€æœ‰å…³é”®æŒ‡æ ‡ï¼ˆDAUã€ç•™å­˜ç‡ã€è½¬åŒ–ç‡ï¼‰
   - å®šæœŸåˆ†ææ•°æ®ï¼Œä¼˜åŒ–ç­–ç•¥
   - A/Bæµ‹è¯•ä¸åŒæ–¹æ¡ˆ

---

**ç¥ä½ ç¡ä¸ªå¥½è§‰ï¼é†’æ¥åå°±å¯ä»¥æ ¹æ®è¿™ä»½æ–‡æ¡£å¼€å§‹å¼€å‘äº†ï¼ğŸ’ªâœ¨**

å¦‚æœæœ‰ä»»ä½•ç–‘é—®ï¼Œå¯ä»¥éšæ—¶é—®æˆ‘ï¼

